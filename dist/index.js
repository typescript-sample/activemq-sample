(()=>{var e={4946:function(e,t){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},n=(Object.defineProperty(t,"__esModule",{value:!0}),/^[1-9]\d*$/);function s(e,t){if(!t)return e;for(var r=e,n=0,i=Object.keys(t);n<i.length;n++){var o,a=i[n],c=t[a];"object"==typeof c?Array.isArray(c)?r[a]=c:(o=r[a])&&"object"==typeof o&&!Array.isArray(o)&&s(o,c):c!==r[a]&&(r[a]=c)}return r}function i(e,t){return o(r({},e),t,void 0)}function o(e,t,r){for(var s,i,a=e,c=0,h=Object.keys(a);c<h.length;c++){var u,l,f=h[c],d=(s=f,function(e){return!e||""===e}(i=r)?s.toUpperCase():i+"_"+s.toUpperCase()),p=t[d];switch(typeof a[f]){case"string":p&&0<p.length&&(a[f]=p);break;case"object":if(Array.isArray(a[f]))try{!p||"object"==typeof(u=JSON.parse(p))&&Array.isArray(u)&&(a[f]=u)}catch(e){console.log("Can't parse value of "+d+" env",e)}else null!==a[f]&&(a[f]=o(a[f],t,d));break;case"number":p&&0<p.length&&n.test(p)&&(a[f]=Number(p));break;case"boolean":!p||(l="true"===t[d])!==a[f]&&(a[f]=l)}}return a}t.merge=function(e,t,r,n){return r&&n&&0!==n.length?i(r[n]?s(e,r[n]):e,t):i(e,t)},t.mergeEnvironments=s,t.mergeEnv=i,t.mergeWithPath=o},9738:(e,t,r)=>{const n=r(7147),s=r(1017),i=r(2037),o=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/gm;function a(e){console.log("[dotenv][DEBUG] "+e)}const c={config:function(e){let t=s.resolve(process.cwd(),".env"),r="utf8";const o=Boolean(e&&e.debug),h=Boolean(e&&e.override);var u;e&&(null!=e.path&&(t="~"===(u=e.path)[0]?s.join(i.homedir(),u.slice(1)):u),null!=e.encoding&&(r=e.encoding));try{const e=c.parse(n.readFileSync(t,{encoding:r}));return Object.keys(e).forEach((function(t){Object.prototype.hasOwnProperty.call(process.env,t)?(!0===h&&(process.env[t]=e[t]),o&&a(!0===h?`"${t}" is already defined in \`process.env\` and WAS overwritten`:`"${t}" is already defined in \`process.env\` and was NOT overwritten`)):process.env[t]=e[t]})),{parsed:e}}catch(e){return o&&a(`Failed to load ${t} `+e.message),{error:e}}},parse:function(e){const t={};let r=e.toString();for(r=r.replace(/\r\n?/gm,"\n");null!=(s=o.exec(r));){var n=s[1];let e=s[2]||"";var s=(e=e.trim())[0];e=e.replace(/^(['"`])([\s\S]*)\1$/gm,"$2"),'"'===s&&(e=(e=e.replace(/\\n/g,"\n")).replace(/\\r/g,"\r")),t[n]=e}return t}};e.exports.config=c.config,e.exports.parse=c.parse,e.exports=c},9249:function(e,t){"use strict";var r=this&&this.__awaiter||function(e,t,r,n){return new(r=r||Promise)((function(s,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):((t=e.value)instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((n=n.apply(e,t||[])).next())}))},n=this&&this.__generator||function(e,t){var r,n,s,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},o={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){var c=[o,a];if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(s=2&c[0]?n.return:c[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,c[1])).done)return s;switch(n=0,(c=s?[2&c[0],s.value]:c)[0]){case 0:case 1:s=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,n=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(s=0<(s=i.trys).length&&s[s.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!s||c[1]>s[0]&&c[1]<s[3])){i.label=c[1];break}if(6===c[0]&&i.label<s[1]){i.label=s[1],s=c;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(c);break}s[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(a){c=[6,a],n=0}finally{r=s=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}};function s(e){return r(this,void 0,void 0,(function(){var t,r,s,i,o,a,c,h;return n(this,(function(n){switch(n.label){case 0:t={status:"UP"},r=e.length-1,s=0,t.details={},i=0,o=e,n.label=1;case 1:if(!(i<o.length))return[3,6];a=o[i],c={status:"UP"},n.label=2;case 2:return n.trys.push([2,4,,5]),[4,a.check()];case 3:return(h=n.sent())&&0<Object.keys(h).length&&(c.data=h),t.details[a.name()]=c,r<=s?[2,t]:(s++,[3,5]);case 4:return h=n.sent(),c.status="DOWN",t.status="DOWN",c.data=a.build({},h),t.details[a.name()]=c,r<=s?[2,t]:(s++,[3,5]);case 5:return i++,[3,1];case 6:return[2,t]}}))}))}Object.defineProperty(t,"__esModule",{value:!0}),t.check=s,o.prototype.check=function(e,t){s(this.checkers).then((function(e){"UP"===e.status?t.writeHead(200,{"Content-Type":"application/json"}):t.writeHead(500,{"Content-Type":"application/json"}),t.write(JSON.stringify(e)),t.end()}))};var i=o;function o(e){this.checkers=e,this.check=this.check.bind(this)}t.HealthController=i,t.HealthHandler=i},2735:(e,t)=>{"use strict";function r(e){return e&&void 0!==(e=t.map[e.toUpperCase()])?e:0}function n(e){return e?{msg:e.msg&&0<e.msg.length?e.msg:"msg",time:e.time&&0<e.time.length?e.time:"time",level:e.level&&0<e.level.length?e.level:"level"}:{msg:"msg",time:"time",level:"level"}}function s(e,t,r,n,s,i,o){setTimeout((function(){var a={};if(a[r.level]=e,a[r.time]=t(),i)for(var c=0,h=Object.keys(i);c<h.length;c++)a[u=h[c]]=i[u];if(a[r.msg]=s,o)for(var u,l=0,f=Object.keys(o);l<f.length;l++)a[u=f[l]]=o[u];n(JSON.stringify(a))}),0)}function i(){return(new Date).toISOString()}Object.defineProperty(t,"__esModule",{value:!0}),t.name={trace:"trace",debug:"debug",info:"info",warn:"warn",error:"error",panic:"panic",fatal:"fatal"},t.NAME={trace:"TRACE",debug:"DEBUG",info:"INFO",warn:"WARN",error:"ERROR",panic:"PANIC",fatal:"FATAL"},t.map={TRACE:-2,DEBUG:-1,INFO:0,WARN:1,ERROR:2,PANIC:3,FATAL:4},t.createLevel=r,t.createMap=n,t.log=s,t.getTime=i,t.createLogger=function(e,t,r,n,s){return new o(e.level,e.map,e.constants,t,r,n,s)},a.prototype.trace=function(e,t){e&&0<e.length&&this.level<=-2&&s(this.name.trace,this.getTime,this.map,this.log,e,this.constants,t)},a.prototype.debug=function(e,t){e&&0<e.length&&this.level<=-1&&s(this.name.debug,this.getTime,this.map,this.log,e,this.constants,t)},a.prototype.info=function(e,t){e&&0<e.length&&this.level<=0&&s(this.name.info,this.getTime,this.map,this.log,e,this.constants,t)},a.prototype.warn=function(e,t){e&&0<e.length&&this.level<=1&&s(this.name.warn,this.getTime,this.map,this.log,e,this.constants,t)},a.prototype.error=function(e,t){e&&0<e.length&&this.level<=2&&s(this.name.error,this.getTime,this.map,this.err,e,this.constants,t)},a.prototype.panic=function(e,t){e&&0<e.length&&this.level<=3&&s(this.name.panic,this.getTime,this.map,this.err,e,this.constants,t)},a.prototype.fatal=function(e,t){e&&0<e.length&&this.level<=4&&s(this.name.fatal,this.getTime,this.map,this.err,e,this.constants,t)},a.prototype.isLevelEnabled=function(e){return this.level<=e},a.prototype.isTraceEnabled=function(){return this.level<=-2},a.prototype.isDebugEnabled=function(){return this.level<=-1},a.prototype.isInfoEnabled=function(){return this.level<=0},a.prototype.isWarnEnabled=function(){return this.level<=1},a.prototype.isErrorEnabled=function(){return this.level<=2},a.prototype.isPanicEnabled=function(){return this.level<=3},a.prototype.isFatalEnabled=function(){return this.level<=4};var o=a;function a(e,s,o,a,c,h,u){this.name=c||t.name,this.level=r(e),this.map=n(s),this.constants=o,this.log=u||console.log,this.err=h||console.error,this.getTime=a||i,this.trace=this.trace.bind(this),this.debug=this.debug.bind(this),this.info=this.info.bind(this),this.warn=this.warn.bind(this),this.error=this.error.bind(this),this.panic=this.panic.bind(this),this.fatal=this.fatal.bind(this),this.isLevelEnabled=this.isLevelEnabled.bind(this),this.isTraceEnabled=this.isTraceEnabled.bind(this),this.isDebugEnabled=this.isDebugEnabled.bind(this),this.isInfoEnabled=this.isInfoEnabled.bind(this),this.isWarnEnabled=this.isWarnEnabled.bind(this),this.isErrorEnabled=this.isErrorEnabled.bind(this),this.isPanicEnabled=this.isPanicEnabled.bind(this),this.isFatalEnabled=this.isFatalEnabled.bind(this)}t.L=o,t.JSONLogger=o,t.SimpleLogger=o,h.prototype.config=function(e,t){var r=this;u(e).then((function(e){e=JSON.parse(e),console.log(e),e&&""!==e||t.writeHead(400).end("The request body cannot be empty"),r.logger||t.writeHead(503).end("Logger is not available"),"string"==typeof e.level&&0<e.level.length&&(r.map||t.writeHead(503).end("Map is not available")),l(r.logger,e,r.map)?t.writeHead(200).end("true"):t.writeHead(204).end("false")}))};var c=h;function h(e,r){this.logger=e,this.map=r||t.map,this.config=this.config.bind(this)}function u(e){return new Promise((function(t,r){try{var n="";e.on("data",(function(e){n+=e.toString()})),e.on("end",(function(){t(n)}))}catch(t){r(t)}}))}function l(e,t,r){var n=!1;return"string"==typeof t.level&&0<t.level.length&&void 0!==(r=r[t.level.toUpperCase()])&&(e.level=r,n=!0),t.map&&("string"==typeof t.map.level&&0<t.map.level.length&&(e.map.level=t.map.level,n=!0),"string"==typeof t.map.time&&0<t.map.time.length&&(e.map.time=t.map.time,n=!0),"string"==typeof t.map.msg&&0<t.map.msg.length&&(e.map.msg=t.map.msg,n=!0)),void 0!==t.constants&&"object"==typeof t.constants&&(0<Object.keys(t.constants).length?e.constants=t.constants:e.constants=void 0,n=!0),t.name&&"string"==typeof t.name.trace&&"string"==typeof t.name.debug&&"string"==typeof t.name.info&&"string"==typeof t.name.warn&&"string"==typeof t.name.error&&"string"==typeof t.name.panic&&"string"==typeof t.name.fatal&&(e.name=t.name,n=!0),n}t.LogController=c,t.LogHandler=c,t.getBody=u,t.update=l,t.updateLog=l,t.change=l,t.changeLog=l},8531:(e,t)=>{"use strict";function r(e,t){return t&&0<Object.keys(t).length?"string"==typeof e?e+" "+JSON.stringify(t):JSON.stringify(e)+" "+JSON.stringify(t):function(e){return"string"==typeof e?e:JSON.stringify(e)}(e)}function n(e,t,r){this.send=e,this.logError=t,this.logInfo=r,this.retry=this.retry.bind(this)}function s(e){this.logError=e,this.error=this.error.bind(this)}Object.defineProperty(t,"__esModule",{value:!0}),t.createRetry=function(e){var t=[];if(e)for(var r=1;r<=200;r++){var n=e[r];if(!n||"number"!=typeof n)return t;t.push(n)}return t},t.toString=r,n.prototype.retry=function(e,t){var n=this;return this.send(e,t).then((function(e){return n.logInfo&&n.logInfo("Retry put to mq success."),e})).catch((function(e){throw n.logError&&n.logError("Retry put to mq error: "+r(e)),e}))},t.RetryService=n,s.prototype.error=function(e,t){return e&&this.logError&&this.logError("Fail to consume message: "+r(e,t)),new Promise((function(e){return e()}))},t.ErrorHandler=s},229:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(8531),s=r(5042),i=r(5668);t.createHandler=function(e,t,r,n,s,i,a,c,h){return new o(e,t,[],i,a,c,r,n,s,h)},a.prototype.handle=function(e,t){var r=this;return new Promise((function(o,a){if(e||a(null),r.logInfo&&r.logInfo("Received message: "+n.toString(e)),"string"==typeof e&&r.json)try{e=JSON.parse(e)}catch(e){return r.logError&&r.logError("Invalid data: "+e),!1}if(r.validate)r.validate(e).then((function(c){if(c&&0<c.length)r.logError&&r.logError("Message is invalid: "+n.toString(e,t)+" . Error: "+n.toString(c)),a(c);else{if(!(r.retries&&0<r.retries.length))return i.write(r.write,e,t,r.handleError,r.retry,r.limitRetry,r.retryCountName,r.logError,r.logInfo);s.writeWithRetry(e,r.write,r.retries,r.handleError,r.logError).then((function(e){o(1)})).catch((function(e){return a(e)}))}}));else{if(!(r.retries&&0<r.retries.length))return i.write(r.write,e,t,r.handleError,r.retry,r.limitRetry,r.retryCountName,r.logError,r.logInfo);s.writeWithRetry(e,r.write,r.retries,r.handleError,r.logError).then((function(e){o(1)})).catch((function(e){return a(e)}))}}))};var o=a;function a(e,t,r,n,s,i,o,a,c,h){this.write=e,this.validate=t,this.retries=r,this.handleError=n,this.logError=s,this.logInfo=i,this.retry=o,this.json=!1!==h,c&&0!==c.length?this.retryCountName=c:this.retryCountName="retryCount",this.limitRetry=a||0,this.handle=this.handle.bind(this)}t.Handler=o},6629:(e,t,r)=>{"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(8531)),n(r(5668)),n(r(5042)),n(r(229))},5042:function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r=r||Promise)((function(s,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):((t=e.value)instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((n=n.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var r,n,s,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},o={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){var c=[o,a];if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(s=2&c[0]?n.return:c[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,c[1])).done)return s;switch(n=0,(c=s?[2&c[0],s.value]:c)[0]){case 0:case 1:s=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,n=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(s=0<(s=i.trys).length&&s[s.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!s||c[1]>s[0]&&c[1]<s[3])){i.label=c[1];break}if(6===c[0]&&i.label<s[1]){i.label=s[1],s=c;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(c);break}s[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(a){c=[6,a],n=0}finally{r=s=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}},i=(Object.defineProperty(t,"__esModule",{value:!0}),r(8531));function o(e,t,r,n){this.retries=t,this.writeError=r,this.logError=n,this.writeTo=e,this.write=this.write.bind(this)}function a(e,t,r,o,a){return n(this,void 0,void 0,(function(){var n,c,h,u,l,f,d;return s(this,(function(s){switch(s.label){case 0:return r&&0!==r.length?[3,1]:[2,t(e).then((function(e){return e})).catch((function(t){if(a&&t&&a("Error: "+i.toString(t)),o)return o(e);throw t}))];case 1:n=r.length,c=n-1,u=!(h=0),l=void 0,s.label=2;case 2:if(!u)return[3,10];s.label=3;case 3:return s.trys.push([3,5,,9]),[4,t(e)];case 4:return f=s.sent(),a&&0<h&&a("Write successfully after "+h+" retries: "+i.toString(e)),l=null,[2,f];case 5:return d=s.sent(),l=d,c<=h?(u=!1,a&&a("Failed to write after "+h+" retries: "+i.toString(e)+". Error: "+i.toString(d)),o?[2,o(e)]:[3,10]):[3,6];case 6:return a&&a("Retrying "+(h+1)+" of "+n+" after error: "+d),[4,new Promise((function(e){return setTimeout(e,r[h])}))];case 7:s.sent(),s.label=8;case 8:return[3,9];case 9:return h++,[3,2];case 10:if(l)throw new Error("after "+n+" attempts, last error: "+l);return[2,0]}}))}))}function c(e,t,r,n){this.retries=t,this.writeError=r,this.logError=n,this.sendTo=e,this.send=this.send.bind(this)}function h(e,t,r,o,a){return n(this,void 0,void 0,(function(){var n,c,h,u,l,f,d;return s(this,(function(s){switch(s.label){case 0:return r&&0!==r.length?[3,1]:[2,t(e).then((function(e){return e})).catch((function(t){if(a&&t&&a("Error: "+i.toString(t)),o)return o(e);throw t}))];case 1:n=r.length,c=n-1,u=!(h=0),l=void 0,s.label=2;case 2:if(!u)return[3,10];s.label=3;case 3:return s.trys.push([3,5,,9]),[4,t(e)];case 4:return f=s.sent(),a&&0<h&&a("Write successfully after "+h+" retries: "+i.toString(e)),l=null,[2,f];case 5:return d=s.sent(),l=d,c<=h?(u=!1,a&&a("Failed to write after "+h+" retries: "+i.toString(e)+". Error: "+i.toString(d)),o?[2,o(e)]:[3,10]):[3,6];case 6:return a&&a("Retrying "+(h+1)+" of "+n+" after error: "+d),[4,new Promise((function(e){return setTimeout(e,r[h])}))];case 7:s.sent(),s.label=8;case 8:return[3,9];case 9:return h++,[3,2];case 10:if(l)throw new Error("after "+n+" attempts, last error: "+l);return[2,""]}}))}))}t.writeWithRetry=function(e,t,r,o,a){return n(this,void 0,void 0,(function(){var n,c,h,u,l,f,d;return s(this,(function(s){switch(s.label){case 0:n=r.length,c=n-1,u=!(h=0),s.label=1;case 1:if(!u)return[3,9];s.label=2;case 2:return s.trys.push([2,4,,8]),[4,t(e)];case 3:return f=s.sent(),a&&0<h&&a("Write successfully after "+h+" retries: "+i.toString(e)),l=null,[2,f];case 4:return d=s.sent(),l=d,c<=h?(u=!1,a&&a("Failed to write after "+h+" retries: "+i.toString(e)+". Error: "+i.toString(d)),o&&o(e),[3,9]):[3,5];case 5:return a&&a("Retrying "+(h+1)+" of "+n+" after error: "+d),[4,new Promise((function(e){return setTimeout(e,r[h])}))];case 6:s.sent(),s.label=7;case 7:return[3,8];case 8:return h++,[3,1];case 9:if(l)throw new Error("after "+n+" attempts, last error: "+l);return[2,0]}}))}))},o.prototype.write=function(e){return a(e,this.writeTo,this.retries,this.writeError,this.logError)},t.RetryWriter=o,t.writeTo=a,c.prototype.send=function(e,t){return h(e,this.sendTo,this.retries,this.writeError,this.logError)},t.RetrySender=c,t.send=h},5668:function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r=r||Promise)((function(s,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):((t=e.value)instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((n=n.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var r,n,s,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},o={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){var c=[o,a];if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(s=2&c[0]?n.return:c[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,c[1])).done)return s;switch(n=0,(c=s?[2&c[0],s.value]:c)[0]){case 0:case 1:s=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,n=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(s=0<(s=i.trys).length&&s[s.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!s||c[1]>s[0]&&c[1]<s[3])){i.label=c[1];break}if(6===c[0]&&i.label<s[1]){i.label=s[1],s=c;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(c);break}s[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(a){c=[6,a],n=0}finally{r=s=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}},i=(Object.defineProperty(t,"__esModule",{value:!0}),r(8531));t.write=function(e,t,r,o,a,c,h,u,l){return n(this,void 0,void 0,(function(){var n,f,d;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,14]),[4,e(t)];case 1:return[2,s.sent()];case 2:return n=s.sent(),u&&u("Fail to write "+i.toString(t)+" . Error: "+i.toString(n)),a?[3,5]:o?[4,o(t,r)]:[3,4];case 3:s.sent(),s.label=4;case 4:throw n;case 5:return f=0,c=c||0,(d=(r=r||{})[h=h||"retryCount"])&&!isNaN(d)&&(f=Number(d)),c<++f?(l&&l("No more retry. Retry limitation: "+c+" . Message: "+i.toString(t,r)+"."),o?[4,o(t,r)]:[3,7]):[3,9];case 6:throw s.sent(),n;case 7:throw n;case 8:return[3,13];case 9:l&&l("Retry: "+f+" . Message: "+i.toString(t,r)+"."),r[h]=f.toString(),s.label=10;case 10:return s.trys.push([10,12,,13]),[4,a(t,r)];case 11:return s.sent(),[2,0];case 12:throw d=s.sent(),u&&u("Cannot retry "+i.toString(t,r)+" . Error: "+i.toString(n)+"."),d;case 13:return[3,14];case 14:return[2]}}))}))}},5697:(e,t,r)=>{"use strict";var n=r(7310),s=r(7147);function i(e){if("/"===e.charAt(0))return{host:(t=e.split(" "))[0],database:t[1]};var t,r;for(r in t=(e=n.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(e)?encodeURI(e).replace(/\%25(\d\d)/g,"%$1"):e,!0)).query)Array.isArray(t[r])&&(t[r]=t[r][t[r].length-1]);var i=(e.auth||":").split(":");if(t.user=i[0],t.password=i.splice(1).join(":"),t.port=e.port,"socket:"==e.protocol)t.host=decodeURI(e.pathname),t.database=e.query.db,t.client_encoding=e.query.encoding;else switch(t.host||(t.host=e.hostname),i=e.pathname,!t.host&&i&&/^%2f/i.test(i)&&(e=i.split("/"),t.host=decodeURIComponent(e[0]),i=e.splice(1).join("/")),i&&"/"===i.charAt(0)&&(i=i.slice(1)||null),t.database=i&&decodeURI(i),"true"!==t.ssl&&"1"!==t.ssl||(t.ssl=!0),"0"===t.ssl&&(t.ssl=!1),(t.sslcert||t.sslkey||t.sslrootcert||t.sslmode)&&(t.ssl={}),t.sslcert&&(t.ssl.cert=s.readFileSync(t.sslcert).toString()),t.sslkey&&(t.ssl.key=s.readFileSync(t.sslkey).toString()),t.sslrootcert&&(t.ssl.ca=s.readFileSync(t.sslrootcert).toString()),t.sslmode){case"disable":t.ssl=!1;break;case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":t.ssl.rejectUnauthorized=!1}return t}(e.exports=i).parse=i},878:(e,t)=>{"use strict";function r(e){return"$"+e}function n(e){for(var t={},r=[],n=[],s=[],i={keys:r,fields:s},o=!1,a=0,c=Object.keys(e);a<c.length;a++){var h=c[a],u=e[h];u.name=h,u.key&&r.push(u),u.ignored||s.push(h),"boolean"===u.type&&n.push(u),u.version&&(i.version=h),(u=(u.field||h).toLowerCase())!==h&&(t[u]=h,o=!0)}return o&&(i.map=t),0<n.length&&(i.bools=n),i}function s(e){return"NaN"==(e=""+e)?"null":e}Object.defineProperty(t,"__esModule",{value:!0}),t.param=r,t.params=function(e,t){void 0!==t&&null!=t||(t=0);for(var n=[],s=1;s<=e;s++)n.push(r(s+t));return n},t.metadata=n,t.buildToSave=function(e,t,n,i,o,a){a=a||1,o=o||r;for(var c,h=Object.keys(n),u=[],l=[],f=[],d=[],p=!1,m=e,g=0,y=h;g<y.length;g++)(v=n[b=y[g]]).name=b,v.key&&u.push(v),void 0===(_=void 0!==(_=m[b])&&null!=_?_:v.default)||null==_||v.ignored||v.noinsert||(T=v.field||b,l.push(T),b===i?(p=!0,f.push("1")):""===_?f.push("''"):"number"==typeof _?f.push(s(_)):"boolean"==typeof _?void 0===v.true?!0===_?f.push("true"):f.push("false"):(c=o(a++),f.push(c),w=!0===_?v.true||"'1'":v.false||"'0'",d.push(w)):(c=o(a++),f.push(c),d.push(_)));if(!p&&i&&0<i.length&&(T=(v=n[i]).field||i,l.push(T),f.push("1")),0!==u.length){for(var b,_,v,w,E,S=[],x=0,C=h;x<C.length;x++)void 0===(_=m[b=C[x]])||!(v=n[b])||v.key||v.ignored||v.noupdate||(T=v.field||b,E=void 0,null==_?E="null":""===_?E="''":"number"==typeof _?E=s(_):"boolean"==typeof _?void 0===v.true?E=!0===_?"true":"false":(E=o(a++),w=!0===_?v.true||"'1'":v.false||"'0'",d.push(w)):(E=o(a++),d.push(_)),S.push(T+"="+E));for(var k=[],P=0,O=u;P<O.length;P++){var T,A=O[P];(T=A.field||A.name)&&k.push(T)}return 0===S.length?{query:"insert into "+t+"("+l.join(",")+")values("+f.join(",")+") on conflict("+k.join(",")+") do nothing",params:d}:{query:"insert into "+t+"("+l.join(",")+")values("+f.join(",")+") on conflict("+k.join(",")+") do update set "+S.join(","),params:d}}if(0!==l.length)return{query:"insert into "+t+"("+l.join(",")+")values("+f.join(",")+")",params:d}},t.buildToSaveBatch=function(e,t,i,o,a){a=a||r;var c=[],h=n(i).keys;if(h&&0!==h.length){for(var u=Object.keys(i),l=0,f=e;l<f.length;l++){for(var d=1,p=[],m=[],g=[],y=!1,b=f[l],_=0,v=u;_<v.length;_++){var w,E=i[S=v[_]];null==(x=void 0!==(x=b[S])&&null!=x?x:E.default)||void 0===x||E.ignored||E.noinsert||(D=E.field||S,p.push(D),S===o?(y=!0,m.push("1")):""===x?m.push("''"):"number"==typeof x?m.push(s(x)):"boolean"==typeof x?void 0===E.true?!0===x?m.push("true"):m.push("false"):(w=a(d++),m.push(w),C=!0===x?E.true||"'1'":E.false||"'0'",g.push(C)):(w=a(d++),m.push(w),g.push(x)))}!y&&o&&0<o.length&&(D=(E=i[o]).field||o,p.push(D),m.push("1"));for(var S,x,C,k,P=[],O=0,T=u;O<T.length;O++)void 0===(x=b[S=T[O]])||!(E=i[S])||E.key||E.ignored||S===o||E.noupdate||(D=E.field||S,k=void 0,null==x?k="null":""===x?k="''":"number"==typeof x?k=s(x):"boolean"==typeof x?void 0===E.true?k=!0===x?"true":"false":(k=a(d++),C=!0===x?E.true||"'1'":E.false||"'0'",g.push(C)):(k=a(d++),g.push(x)),P.push(D+"="+k));for(var A,R=[],M=0,I=h;M<I.length;M++){var D,q=I[M];(D=q.field||q.name)&&R.push(D)}A=0===P.length?{query:"insert into "+t+"("+p.join(",")+")values("+m.join(",")+") on conflict("+R.join(",")+") do nothing",params:g}:{query:"insert into "+t+"("+p.join(",")+")values("+m.join(",")+") on conflict("+R.join(",")+") do update set "+P.join(","),params:g},c.push(A)}return c}},t.toString=s},627:function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r=r||Promise)((function(s,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):((t=e.value)instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((n=n.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var r,n,s,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},o={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){var c=[o,a];if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(s=2&c[0]?n.return:c[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,c[1])).done)return s;switch(n=0,(c=s?[2&c[0],s.value]:c)[0]){case 0:case 1:s=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,n=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(s=0<(s=i.trys).length&&s[s.length-1])&&(6===c[0]||2===c[0])){i=0;continue}if(3===c[0]&&(!s||c[1]>s[0]&&c[1]<s[3])){i.label=c[1];break}if(6===c[0]&&i.label<s[1]){i.label=s[1],s=c;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(c);break}s[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(e,i)}catch(a){c=[6,a],n=0}finally{r=s=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}};Object.defineProperty(t,"__esModule",{value:!0});var i,o=r(8955),a=r(878),c=r(878);for(i in c)t.hasOwnProperty(i)||(t[i]=c[i]);var h=function(){};function u(e){this.pool=e,this.driver="postgres",this.param=this.param.bind(this),this.exec=this.exec.bind(this),this.execBatch=this.execBatch.bind(this),this.query=this.query.bind(this),this.queryOne=this.queryOne.bind(this),this.execScalar=this.execScalar.bind(this),this.count=this.count.bind(this)}function l(e){this.client=e,this.driver="postgres",this.param=this.param.bind(this),this.exec=this.exec.bind(this),this.execBatch=this.execBatch.bind(this),this.query=this.query.bind(this),this.queryOne=this.queryOne.bind(this),this.execScalar=this.execScalar.bind(this),this.count=this.count.bind(this)}function f(e){"23505"===e.code&&(e.error="duplicate")}function d(e,t,r){var n=v(r);return new Promise((function(r,s){return e.query(t,n,(function(e,t){return e?(f(e),s(e)):r(t.rowCount)}))}))}function p(e,t,r,n,s){var i=v(r);return new Promise((function(r,o){return e.query(t,i,(function(e,t){return e?o(e):r(w(t.rows,n,s))}))}))}function m(e,t,r,n,s){return p(e,t,r,n,s).then((function(e){return e&&0<e.length?e[0]:null}))}function g(e,t,r){return m(e,t,r).then((function(e){return e?e[Object.keys(e)[0]]:null}))}function y(e,t,r){return g(e,t,r)}function b(e,t,r){return n(this,void 0,void 0,(function(){var n,i,o,a,c,h;return s(this,(function(s){switch(s.label){case 0:return t&&0!==t.length?1===t.length?[2,d(e,t[0].query,v(t[0].params))]:[4,e.connect()]:[2,Promise.resolve(0)];case 1:if(n=s.sent(),i=0,!r)return[3,11];s.label=2;case 2:return s.trys.push([2,8,,10]),[4,n.query("begin")];case 3:return s.sent(),[4,n.query(t[0].query,v(t[0].params))];case 4:return(o=s.sent())&&0!==o.rowCount?(c=(c=t.slice(1)).map((function(e){return n.query(e.query,e.params||[])})),[4,Promise.all(c).then((function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];i+=n.rowCount}}))]):[3,7];case 5:return s.sent(),i+=o.rowCount,[4,n.query("commit")];case 6:s.sent(),n.release(),s.label=7;case 7:return[2,i];case 8:return f(a=s.sent()),[4,n.query("rollback")];case 9:throw s.sent(),n.release(),a;case 10:return[3,17];case 11:return s.trys.push([11,15,,17]),[4,n.query("begin")];case 12:return s.sent(),c=t.map((function(e,t){return n.query(e.query,v(e.params))})),[4,Promise.all(c).then((function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];i+=n.rowCount}}))];case 13:return s.sent(),[4,n.query("commit")];case 14:return s.sent(),n.release(),[2,i];case 15:return h=s.sent(),[4,n.query("rollback")];case 16:throw s.sent(),n.release(),h;case 17:return[2]}}))}))}function _(e,t,r){return n(this,void 0,void 0,(function(){var n,i,o,a,c;return s(this,(function(s){switch(s.label){case 0:if(!t||0===t.length)return[2,Promise.resolve(0)];if(1===t.length)return[2,d(e,t[0].query,t[0].params)];if(n=0,!r)return[3,10];s.label=1;case 1:return s.trys.push([1,7,,9]),[4,e.query("begin")];case 2:return s.sent(),[4,e.query(t[0].query,v(t[0].params))];case 3:return(i=s.sent())&&0!==i.rowCount?(a=(a=t.slice(1)).map((function(t,r){return e.query(t.query,t.params||[])})),[4,Promise.all(a).then((function(e){for(var t=0,r=e;t<r.length;t++){var s=r[t];n+=s.rowCount}}))]):[3,6];case 4:return s.sent(),n+=i.rowCount,[4,e.query("commit")];case 5:s.sent(),e.release(),s.label=6;case 6:return[2,n];case 7:return o=s.sent(),[4,e.query("rollback")];case 8:throw s.sent(),o;case 9:return[3,16];case 10:return s.trys.push([10,14,,16]),[4,e.query("begin")];case 11:return s.sent(),a=t.map((function(t,r){return e.query(t.query,v(t.params))})),[4,Promise.all(a).then((function(e){for(var t=0,r=e;t<r.length;t++){var s=r[t];n+=s.rowCount}}))];case 12:return s.sent(),[4,e.query("commit")];case 13:return s.sent(),e.release(),[2,n];case 14:return c=s.sent(),[4,e.query("rollback")];case 15:throw s.sent(),e.release(),c;case 16:return[2]}}))}))}function v(e){if(!e||0===e.length)return[];for(var t,r=[],n=e.length,s=0;s<n;s++)void 0===e[s]||null==e[s]?r.push(null):"object"!=typeof e[s]||e[s]instanceof Date||!h.string?r.push(e[s]):(t=JSON.stringify(e[s]),r.push(t));return r}function w(e,t,r){return t?(t=S(e,t),r&&0<r.length?E(t,r):t):r&&0<r.length?E(e,r):e}function E(e,t){if(t&&0!==t.length&&e)for(var r=0,n=e;r<n.length;r++)for(var s=n[r],i=0,o=t;i<o.length;i++){var a,c,h=o[i];!h.name||"boolean"!=typeof(a=s[h.name])&&null!=a&&void 0!==a&&(c=h.true,s[h.name]=null==c||void 0===c?"true"==a||"1"==a||"t"==a||"y"==a||"on"==a:a==c)}return e}function S(e,t){if(!t)return e;if(0===Object.keys(t).length)return e;for(var r=[],n=e.length,s=0;s<n;s++){for(var i=e[s],o={},a=0,c=Object.keys(i);a<c.length;a++){var h=c[a];o[t[h]||h]=i[h]}r.push(o)}return r}function x(e,t){if(e&&0!==e.length){var r=[];if(!t)return e;for(var n=0,s=e;n<s.length;n++){var i=s[n];t.includes(i)&&r.push(i)}return 0!==r.length?r:void 0}}function C(e){for(var t=0,r=Object.keys(e);t<r.length;t++){var n=r[t],s=e[n];if(s.version)return s.name=n,s}}function k(e,t,r,n,s){this.table=t,this.attributes=r,this.write=this.write.bind(this),"function"==typeof e?this.exec=e:this.pool=e,this.param=s,this.map=n,(t=C(r))&&(this.version=t.name)}function P(e,t,r,n,s){this.table=t,this.attributes=r,this.write=this.write.bind(this),"function"==typeof e?this.execute=e:this.pool=e,this.param=s,this.map=n,(t=C(r))&&(this.version=t.name)}function O(e,t,r){this.pool=e,this.timeout=r||4200,this.service=t||"mysql",this.check=this.check.bind(this),this.name=this.name.bind(this),this.build=this.build.bind(this)}function T(e,t,r,n){this.table=e,this.field=t,this.query=r,this.exec=n,this.load=this.load.bind(this),this.save=this.save.bind(this)}function A(e,t,r,n,s){this.db=e,this.table=t,this.id=r||"id",this.code=s||"code",this.expiredAt=n||"expiredat",this.load=this.load.bind(this),this.delete=this.delete.bind(this),this.save=this.save.bind(this)}t.resource=h,t.createPool=function(e){return new o.Pool(e)},u.prototype.param=function(e){return"$"+e},u.prototype.exec=function(e,t,r){return d(r||this.pool,e,t)},u.prototype.execBatch=function(e,t,r){return b(r||this.pool,e,t)},u.prototype.query=function(e,t,r,n,s){return p(s||this.pool,e,t,r,n)},u.prototype.queryOne=function(e,t,r,n,s){return m(s||this.pool,e,t,r,n)},u.prototype.execScalar=function(e,t,r){return g(r||this.pool,e,t)},u.prototype.count=function(e,t,r){return y(r||this.pool,e,t)},t.PoolManager=u,l.prototype.param=function(e){return"$"+e},l.prototype.exec=function(e,t,r){return r||this.client,d(this.client,e,t)},l.prototype.execBatch=function(e,t,r){return _(r||this.client,e,t)},l.prototype.query=function(e,t,r,n,s){return p(s||this.client,e,t,r,n)},l.prototype.queryOne=function(e,t,r,n,s){return m(s||this.client,e,t,r,n)},l.prototype.execScalar=function(e,t,r){return g(r||this.client,e,t)},l.prototype.count=function(e,t,r){return y(r||this.client,e,t)},t.PoolClientManager=l,t.exec=d,t.query=p,t.queryOne=m,t.execScalar=g,t.count=y,t.execBatch=b,t.execBatchWithClient=_,t.save=function(e,t,r,n,s,i){return(t=a.buildToSave(t,r,n,s,i))?"function"==typeof e?e(t.query,t.params):d(e,t.query,t.params):Promise.resolve(-1)},t.saveBatch=function(e,t,r,n,s,i){return(t=a.buildToSaveBatch(t,r,n,s,i))?b(e,t):Promise.resolve(-1)},t.saveBatchWithClient=function(e,t,r,n,s,i){return(t=a.buildToSaveBatch(t,r,n,s,i))?_(e,t):Promise.resolve(-1)},t.toArray=v,t.handleResults=w,t.handleBool=E,t.map=function(e,t){if(!t)return e;if(0===Object.keys(t).length)return e;for(var r={},n=0,s=Object.keys(e);n<s.length;n++){var i=s[n];r[t[i]||i]=e[i]}return r},t.mapArray=S,t.getFields=x,t.buildFields=function(e,t){return(e=x(e,t))&&0!==e.length?e.join(","):"*"},t.getMapField=function(e,t){return(t=t&&t[e])&&"string"==typeof t?t:e},t.isEmpty=function(e){return!(e&&0<e.length)},t.version=C,k.prototype.write=function(e){if(!e)return Promise.resolve(0);var t=e;return this.map&&(t=this.map(e)),(e=a.buildToSave(t,this.table,this.attributes,this.version,this.param))?this.exec?this.exec(e.query,e.params):d(this.pool,e.query,e.params):Promise.resolve(0)},t.PostgreSQLWriter=k,P.prototype.write=function(e){if(!e||0===e.length)return Promise.resolve(0);var t=e;if(this.map){t=[];for(var r=0,n=e;r<n.length;r++){var s=n[r];s=this.map(s),t.push(s)}}return(e=a.buildToSaveBatch(t,this.table,this.attributes,this.version,this.param))&&0<e.length?this.execute?this.execute(e):b(this.pool,e):Promise.resolve(0)},t.PostgreSQLBatchWriter=P,O.prototype.check=function(){return n(this,void 0,void 0,(function(){var e,t,r=this;return s(this,(function(n){switch(n.label){case 0:return e={},[4,this.pool.connect()];case 1:return n.sent(),t=new Promise((function(t,n){r.pool.query("select now()",(function(r,s){if(r)return n(r);t(e)}))})),0<this.timeout?[2,(s=this.timeout,Promise.race([t,new Promise((function(e,t){setTimeout((function(){t("Timed out in: "+s+" milliseconds!")}),s)}))]))]:[2,t]}var s}))}))},O.prototype.name=function(){return this.service},O.prototype.build=function(e,t){return t&&((e=e||{}).error=t),e},t.PostgreSQLChecker=O,T.prototype.load=function(e,t){var r=this;return this.query("select "+this.field+" from "+this.table+" where "+this.field+" ilike $1 order by "+this.field+" limit "+(t&&0<t?t:20),[e+"%"]).then((function(e){return e.map((function(e){return e[r.field]}))}))},T.prototype.save=function(e){if(e&&0!==e.length){for(var t=[],r=[],n=1,s=0,i=e;s<i.length;s++){var o=i[s];o&&0<o.length&&(t.push("($"+n+++")"),r.push(o))}return 0===t.length?Promise.resolve(0):(e="insert into "+this.table+"("+this.field+") values "+t.join(",")+" on conflict("+this.field+") do nothing",this.exec(e,r))}return Promise.resolve(0)},r=T,t.StringService=r,t.StringRepository=r,A.prototype.save=function(e,t,r){var n="\n      insert into "+this.table+" ("+this.id+", "+this.code+", "+this.expiredAt+")\n      values ("+this.db.param(1)+", "+this.db.param(2)+", "+this.db.param(3)+")\n      on conflict ("+this.id+")\n      do update set "+this.code+" = "+this.db.param(4)+", "+this.expiredAt+" = "+this.db.param(5);return this.db.exec(n,[e,t,r,t,r])},A.prototype.load=function(e){var t="select "+this.code+" as code, "+this.expiredAt+" as expiredat from "+this.table+" where "+this.id+" = "+this.db.param(1);return this.db.query(t,[e]).then((function(e){var t;return e&&0!==e.length?((t={}).code=e[0].code,t.expiredAt=e[0].expiredat,t):null}))},A.prototype.delete=function(e){var t="delete from "+this.table+" where "+this.id+" = "+this.db.param(1);return this.db.exec(t,[e])},r=A,t.CodeRepository=r,t.PasscodeRepository=r,t.SqlPasscodeRepository=r,t.SqlCodeRepository=r,t.CodeService=r,t.PasscodeService=r,t.SqlPasscodeService=r,t.SqlCodeService=r,M.prototype.load=function(e){return this.query(e)},M.prototype.query=function(e){if(!e||0===e.length)return Promise.resolve([]);for(var t=[],r=[],n=e.length,s=1;s<=n;s++)t.push(e[s-1]),r.push(a.param(s));var i="select "+this.id+" as id, "+this.url+" as url from "+this.table+" where "+this.id+" in ("+r.join(",")+") and "+this.url+" is not null order by "+this.id;return this.queryF(i,t)};var R=M;function M(e,t,r,n){this.queryF=e,this.table=t,this.id=n&&0<n.length?n:"id",this.url=r&&0<r.length?r:"url",this.query=this.query.bind(this),this.load=this.load.bind(this)}function I(e,t,r,n,s){this.select=e,this.execute=t,this.table=r,this.field=n,this.id=s&&0<s.length?s:"id",this.load=this.load.bind(this),this.insert=this.insert.bind(this),this.update=this.update.bind(this)}function D(e,t,r,n,s,i,o,a,c,h,u){this.execute=e,this.followingTable=t,this.id=r,this.following=n,this.followerTable=s,this.followerId=i,this.follower=o,this.infoTable=a,this.infoId=c,this.followerCount=h,this.followingCount=u,this.follow=this.follow.bind(this),this.unfollow=this.unfollow.bind(this),this.checkFollow=this.checkFollow.bind(this)}t.UrlQuery=R,t.useUrlQuery=function(e,t,r,n){return new R(e,t,r,n).query},I.prototype.load=function(e){return this.select("select "+this.id+" as id, "+this.field+" as items from "+this.table+" where "+this.id+" = $1",[e]).then((function(e){return e&&0<e.length?e[0].items&&0<e[0].items.length?e[0].items:[]:null}))},I.prototype.insert=function(e,t){var r="insert into "+this.table+"("+this.id+", "+this.field+") values ($1, $2)";return this.execute(r,[e,t])},I.prototype.update=function(e,t){var r="update "+this.table+" set "+this.field+" = $1 where "+this.id+" = $2";return this.execute(r,[t,e])},t.ArrayRepository=I,D.prototype.follow=function(e,t){var r=this,n="select * from "+this.followingTable+" where "+this.id+" = $1 and "+this.following+"=$2 ",s="insert into "+this.followingTable+"("+this.id+", "+this.following+") values ($1, $2)",i="insert into "+this.followerTable+"("+this.followerId+", "+this.follower+") values ($1, $2)",o="\n            insert into "+this.infoTable+"("+this.infoId+","+this.followingCount+", "+this.followerCount+")\n            values ($1, 1, 0)\n            on conflict ("+this.infoId+") do update set "+this.followingCount+" =   "+this.infoTable+"."+this.followingCount+" + 1",a="\n            insert into "+this.infoTable+"("+this.infoId+","+this.followingCount+", "+this.followerCount+")\n            values ($1, 0, 1)\n            on conflict ("+this.infoId+") do update set "+this.followerCount+" = "+this.infoTable+"."+this.followerCount+" + 1";return this.execute([{query:n,params:[e,t]}],!0).then((function(n){return n?Promise.resolve(0):r.execute([{query:s,params:[e,t]},{query:i,params:[t,e]},{query:o,params:[e]},{query:a,params:[t]}],!0)}))},D.prototype.unfollow=function(e,t){var r="delete from "+this.followingTable+" where "+this.id+" = $1 and "+this.following+"=$2",n="delete from "+this.followerTable+" where "+this.followerId+" = $1 and "+this.follower+"=$2",s="\n            update "+this.infoTable+"\n            set "+this.followingCount+" = "+this.followingCount+" -1\n            where "+this.infoId+" = $1",i="\n            update "+this.infoTable+"\n            set "+this.followerCount+" ="+this.followerCount+" - 1\n            where "+this.infoId+" = $1";return this.execute([{query:r,params:[e,t]},{query:n,params:[t,e]},{query:s,params:[e]},{query:i,params:[t]}],!0)},D.prototype.checkFollow=function(e,t){var r="select "+this.id+" from "+this.followingTable+" where "+this.id+" = $1 and "+this.following+" = $2 ";return this.execute([{query:r,params:[e,t]}],!0)},r=D,t.FollowService=r,t.FollowRepository=r},6064:e=>{"use strict";var t=1e6;e.exports=function(e){var r,n,s,i,o=e.readInt32BE(0),a=(e=e.readUInt32BE(4),""),c=(o<0&&(o=~o+(0===e),e=1+~e>>>0,a="-"),""),h=o%t,u=(o=o/t>>>0,""+((r=4294967296*h+e)-t*(e=r/t>>>0)));if(0===e&&0===o)return a+u+c;for(n="",s=6-u.length,i=0;i<s;i++)n+="0";if(c=n+u+c,h=o%t,o=o/t>>>0,u=""+((r=4294967296*h+e)-t*(e=r/t>>>0)),0===e&&0===o)return a+u+c;for(n="",s=6-u.length,i=0;i<s;i++)n+="0";if(c=n+u+c,h=o%t,o=o/t>>>0,u=""+((r=4294967296*h+e)-t*(e=r/t>>>0)),0===e&&0===o)return a+u+c;for(n="",s=6-u.length,i=0;i<s;i++)n+="0";return c=n+u+c,a+(u=""+(o%t*4294967296+e)%t)+c}},5546:(e,t,r)=>{"use strict";var n=r(2361).EventEmitter;function s(){}const i=(e,t)=>-1===(t=e.findIndex(t))?void 0:e.splice(t,1)[0];class o{constructor(e,t,r){this.client=e,this.idleListener=t,this.timeoutId=r}}class a{constructor(e){this.callback=e}}function c(e,t){if(t)return{callback:t,result:void 0};let r,n;return{callback:function(e,t){e?r(e):n(t)},result:new e((function(e,t){n=e,r=t}))}}e.exports=class extends n{constructor(e,t){super(),this.options=Object.assign({},e),null!=e&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),null!=e&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||t||r(8955).Client,this.Promise=this.options.Promise||global.Promise,void 0===this.options.idleTimeoutMillis&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended)this.log("pulse queue ended");else if(this.ending)this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map((e=>{this._remove(e.client)})),this._clients.length||(this.ended=!0,this._endCallback());else if(this._pendingQueue.length){if(this._idle.length||!this._isFull()){var e=this._pendingQueue.shift();if(this._idle.length){var t=this._idle.pop();clearTimeout(t.timeoutId);const r=t.client;return r.ref&&r.ref(),t=t.idleListener,this._acquireClient(r,e,t,!1)}if(this._isFull())throw new Error("unexpected condition");return this.newClient(e)}}else this.log("no queued requests")}_remove(e){var t=i(this._idle,(t=>t.client===e));void 0!==t&&clearTimeout(t.timeoutId),this._clients=this._clients.filter((t=>t!==e)),e.end(),this.emit("remove",e)}connect(e){if(this.ending)return r=new Error("Cannot use a pool after calling end on the pool"),e?e(r):this.Promise.reject(r);const t=c(this.Promise,e);var r=t.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick((()=>this._pulseQueue())),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new a(t.callback)),r;const e=(e,r,n)=>{clearTimeout(s),t.callback(e,r,n)},n=new a(e),s=setTimeout((()=>{i(this._pendingQueue,(t=>t.callback===e)),n.timedOut=!0,t.callback(new Error("timeout exceeded when trying to connect"))}),this.options.connectionTimeoutMillis);this._pendingQueue.push(n)}else this.newClient(new a(t.callback));return r}newClient(e){function t(e){(e.client=i).removeListener("error",t),i.on("error",(()=>{n.log("additional client error after disconnection due to error",e)})),n._remove(i),n.emit("error",e,i)}const r=new this.Client(this.options);var n,i;this._clients.push(r),n=this,i=r,this.log("checking client timeout");let o,c=!1;this.options.connectionTimeoutMillis&&(o=setTimeout((()=>{this.log("ending client due to timeout"),c=!0,r.connection?r.connection.stream.destroy():r.end()}),this.options.connectionTimeoutMillis)),this.log("connecting new client"),r.connect((n=>{if(o&&clearTimeout(o),r.on("error",t),!n)return this.log("new client connected"),0!==this.options.maxLifetimeSeconds&&setTimeout((()=>{this.log("ending client due to expired lifetime"),this._expired.add(r),-1!==this._idle.findIndex((e=>e.client===r))&&this._acquireClient(r,new a(((e,t,r)=>r())),t,!1)}),1e3*this.options.maxLifetimeSeconds),this._acquireClient(r,e,t,!0);this.log("client failed to connect",n),this._clients=this._clients.filter((e=>e!==r)),c&&(n.message="Connection terminated due to connection timeout"),this._pulseQueue(),e.timedOut||e.callback(n,void 0,s)}))}_acquireClient(e,t,r,n){n&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,r),e.removeListener("error",r),t.timedOut?n&&this.options.verify?this.options.verify(e,e.release):e.release():n&&this.options.verify?this.options.verify(e,(r=>{if(r)return e.release(r),t.callback(r,void 0,s);t.callback(void 0,e,e.release)})):t.callback(void 0,e,e.release)}_releaseOnce(e,t){let r=!1;return n=>{if(r)throw new Error("Release called on client which has already been released to the pool.");r=!0,this._release(e,t,n)}}_release(e,t,r){if(e.on("error",t),e._poolUseCount=(e._poolUseCount||0)+1,r||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses)e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e),this._pulseQueue();else if(this._expired.has(e))this.log("remove expired client"),this._expired.delete(e),this._remove(e),this._pulseQueue();else{let r;this.options.idleTimeoutMillis&&(r=setTimeout((()=>{this.log("remove idle client"),this._remove(e)}),this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&r.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new o(e,t,r)),this._pulseQueue()}}query(e,t,r){if("function"==typeof e){const t=c(this.Promise,e);return setImmediate((function(){return t.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))})),t.result}"function"==typeof t&&(r=t,t=void 0);const n=c(this.Promise,r);return r=n.callback,this.connect(((n,s)=>{if(n)return r(n);let i=!1;const o=e=>{i||(i=!0,s.release(e),r(e))};s.once("error",o),this.log("dispatching query"),s.query(e,t,((e,t)=>{if(this.log("query dispatched"),s.removeListener("error",o),!i)return i=!0,s.release(e),e?r(e):r(void 0,t)}))})),n.result}end(e){if(this.log("ending"),this.ending)return t=new Error("Called end on pool more than once"),e?e(t):this.Promise.reject(t);this.ending=!0;var t=c(this.Promise,e);return this._endCallback=t.callback,this._pulseQueue(),t.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce(((e,t)=>e+(this._expired.has(t)?1:0)),0)}get totalCount(){return this._clients.length}}},1144:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BufferReader=void 0;const r=Buffer.allocUnsafe(0);t.BufferReader=class{constructor(e=0){this.offset=e,this.buffer=r,this.encoding="utf-8"}setBuffer(e,t){this.offset=e,this.buffer=t}int16(){var e=this.buffer.readInt16BE(this.offset);return this.offset+=2,e}byte(){var e=this.buffer[this.offset];return this.offset++,e}int32(){var e=this.buffer.readInt32BE(this.offset);return this.offset+=4,e}string(e){var t=this.buffer.toString(this.encoding,this.offset,this.offset+e);return this.offset+=e,t}cstring(){var e=this.offset;let t=e;for(;0!==this.buffer[t++];);return this.offset=t,this.buffer.toString(this.encoding,e,t-1)}bytes(e){var t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}}},246:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Writer=void 0,t.Writer=class{constructor(e=256){this.size=e,this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(e)}ensure(e){var t;this.buffer.length-this.offset<e&&(e=(t=this.buffer).length+(t.length>>1)+e,this.buffer=Buffer.allocUnsafe(e),t.copy(this.buffer))}addInt32(e){return this.ensure(4),this.buffer[this.offset++]=e>>>24&255,this.buffer[this.offset++]=e>>>16&255,this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addInt16(e){return this.ensure(2),this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addCString(e){var t;return e?(t=Buffer.byteLength(e),this.ensure(t+1),this.buffer.write(e,this.offset,"utf-8"),this.offset+=t):this.ensure(1),this.buffer[this.offset++]=0,this}addString(e=""){var t=Buffer.byteLength(e);return this.ensure(t),this.buffer.write(e,this.offset),this.offset+=t,this}add(e){return this.ensure(e.length),e.copy(this.buffer,this.offset),this.offset+=e.length,this}join(e){var t;return e&&(this.buffer[this.headerPosition]=e,t=this.offset-(this.headerPosition+1),this.buffer.writeInt32BE(t,this.headerPosition+1)),this.buffer.slice(e?0:5,this.offset)}flush(e){return e=this.join(e),this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(this.size),e}}},8152:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseError=t.serialize=t.parse=void 0;const n=r(2510),s=(Object.defineProperty(t,"DatabaseError",{enumerable:!0,get:function(){return n.DatabaseError}}),r(9209)),i=(Object.defineProperty(t,"serialize",{enumerable:!0,get:function(){return s.serialize}}),r(946));t.parse=function(e,t){const r=new i.Parser;return e.on("data",(e=>r.parse(e,t))),new Promise((t=>e.on("end",(()=>t()))))}},2510:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NoticeMessage=t.DataRowMessage=t.CommandCompleteMessage=t.ReadyForQueryMessage=t.NotificationResponseMessage=t.BackendKeyDataMessage=t.AuthenticationMD5Password=t.ParameterStatusMessage=t.ParameterDescriptionMessage=t.RowDescriptionMessage=t.Field=t.CopyResponse=t.CopyDataMessage=t.DatabaseError=t.copyDone=t.emptyQuery=t.replicationStart=t.portalSuspended=t.noData=t.closeComplete=t.bindComplete=t.parseComplete=void 0,t.parseComplete={name:"parseComplete",length:5},t.bindComplete={name:"bindComplete",length:5},t.closeComplete={name:"closeComplete",length:5},t.noData={name:"noData",length:5},t.portalSuspended={name:"portalSuspended",length:5},t.replicationStart={name:"replicationStart",length:4},t.emptyQuery={name:"emptyQuery",length:4},t.copyDone={name:"copyDone",length:4};class r extends Error{constructor(e,t,r){super(e),this.length=t,this.name=r}}t.DatabaseError=r,t.CopyDataMessage=class{constructor(e,t){this.length=e,this.chunk=t,this.name="copyData"}},t.CopyResponse=class{constructor(e,t,r,n){this.length=e,this.name=t,this.binary=r,this.columnTypes=new Array(n)}},t.Field=class{constructor(e,t,r,n,s,i,o){this.name=e,this.tableID=t,this.columnID=r,this.dataTypeID=n,this.dataTypeSize=s,this.dataTypeModifier=i,this.format=o}},t.RowDescriptionMessage=class{constructor(e,t){this.length=e,this.fieldCount=t,this.name="rowDescription",this.fields=new Array(this.fieldCount)}},t.ParameterDescriptionMessage=class{constructor(e,t){this.length=e,this.parameterCount=t,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}},t.ParameterStatusMessage=class{constructor(e,t,r){this.length=e,this.parameterName=t,this.parameterValue=r,this.name="parameterStatus"}},t.AuthenticationMD5Password=class{constructor(e,t){this.length=e,this.salt=t,this.name="authenticationMD5Password"}},t.BackendKeyDataMessage=class{constructor(e,t,r){this.length=e,this.processID=t,this.secretKey=r,this.name="backendKeyData"}},t.NotificationResponseMessage=class{constructor(e,t,r,n){this.length=e,this.processId=t,this.channel=r,this.payload=n,this.name="notification"}},t.ReadyForQueryMessage=class{constructor(e,t){this.length=e,this.status=t,this.name="readyForQuery"}},t.CommandCompleteMessage=class{constructor(e,t){this.length=e,this.text=t,this.name="commandComplete"}},t.DataRowMessage=class{constructor(e,t){this.length=e,this.fields=t,this.name="dataRow",this.fieldCount=t.length}},t.NoticeMessage=class{constructor(e,t){this.length=e,this.message=t,this.name="notice"}}},946:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;const s=r(2510),i=r(1144),o=n(r(9491)),a=Buffer.allocUnsafe(0);t.Parser=class{constructor(e){if(this.buffer=a,this.bufferLength=0,this.bufferOffset=0,this.reader=new i.BufferReader,"binary"===(null==e?void 0:e.mode))throw new Error("Binary mode not supported yet");this.mode=(null==e?void 0:e.mode)||"text"}parse(e,t){this.mergeBuffer(e);var r=this.bufferOffset+this.bufferLength;let n=this.bufferOffset;for(;n+5<=r;){var s=this.buffer[n],i=this.buffer.readUInt32BE(n+1),o=1+i;if(!(o+n<=r))break;t(this.handlePacket(n+5,s,i,this.buffer)),n+=o}n===r?(this.buffer=a,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=r-n,this.bufferOffset=n)}mergeBuffer(e){if(0<this.bufferLength){var t=this.bufferLength+e.byteLength;if(t+this.bufferOffset>this.buffer.byteLength){let e;if(t<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)e=this.buffer;else{let r=2*this.buffer.byteLength;for(;t>=r;)r*=2;e=Buffer.allocUnsafe(r)}this.buffer.copy(e,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=e,this.bufferOffset=0}e.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=t}else this.buffer=e,this.bufferOffset=0,this.bufferLength=e.byteLength}handlePacket(e,t,r,n){switch(t){case 50:return s.bindComplete;case 49:return s.parseComplete;case 51:return s.closeComplete;case 110:return s.noData;case 115:return s.portalSuspended;case 99:return s.copyDone;case 87:return s.replicationStart;case 73:return s.emptyQuery;case 68:return this.parseDataRowMessage(e,r,n);case 67:return this.parseCommandCompleteMessage(e,r,n);case 90:return this.parseReadyForQueryMessage(e,r,n);case 65:return this.parseNotificationMessage(e,r,n);case 82:return this.parseAuthenticationResponse(e,r,n);case 83:return this.parseParameterStatusMessage(e,r,n);case 75:return this.parseBackendKeyData(e,r,n);case 69:return this.parseErrorMessage(e,r,n,"error");case 78:return this.parseErrorMessage(e,r,n,"notice");case 84:return this.parseRowDescriptionMessage(e,r,n);case 116:return this.parseParameterDescriptionMessage(e,r,n);case 71:return this.parseCopyInMessage(e,r,n);case 72:return this.parseCopyOutMessage(e,r,n);case 100:return this.parseCopyData(e,r,n);default:o.default.fail("unknown message code: "+t.toString(16))}}parseReadyForQueryMessage(e,t,r){return this.reader.setBuffer(e,r),e=this.reader.string(1),new s.ReadyForQueryMessage(t,e)}parseCommandCompleteMessage(e,t,r){return this.reader.setBuffer(e,r),e=this.reader.cstring(),new s.CommandCompleteMessage(t,e)}parseCopyData(e,t,r){return r=r.slice(e,e+(t-4)),new s.CopyDataMessage(t,r)}parseCopyInMessage(e,t,r){return this.parseCopyMessage(e,t,r,"copyInResponse")}parseCopyOutMessage(e,t,r){return this.parseCopyMessage(e,t,r,"copyOutResponse")}parseCopyMessage(e,t,r,n){this.reader.setBuffer(e,r),e=0!==this.reader.byte();var i=this.reader.int16();const o=new s.CopyResponse(t,n,e,i);for(let e=0;e<i;e++)o.columnTypes[e]=this.reader.int16();return o}parseNotificationMessage(e,t,r){this.reader.setBuffer(e,r),e=this.reader.int32(),r=this.reader.cstring();var n=this.reader.cstring();return new s.NotificationResponseMessage(t,e,r,n)}parseRowDescriptionMessage(e,t,r){this.reader.setBuffer(e,r);var n=this.reader.int16();const i=new s.RowDescriptionMessage(t,n);for(let e=0;e<n;e++)i.fields[e]=this.parseField();return i}parseField(){var e=this.reader.cstring(),t=this.reader.int32(),r=this.reader.int16(),n=this.reader.int32(),i=this.reader.int16(),o=this.reader.int32(),a=0===this.reader.int16()?"text":"binary";return new s.Field(e,t,r,n,i,o,a)}parseParameterDescriptionMessage(e,t,r){this.reader.setBuffer(e,r);var n=this.reader.int16();const i=new s.ParameterDescriptionMessage(t,n);for(let e=0;e<n;e++)i.dataTypeIDs[e]=this.reader.int32();return i}parseDataRowMessage(e,t,r){this.reader.setBuffer(e,r);var n=this.reader.int16();const i=new Array(n);for(let e=0;e<n;e++){var o=this.reader.int32();i[e]=-1===o?null:this.reader.string(o)}return new s.DataRowMessage(t,i)}parseParameterStatusMessage(e,t,r){return this.reader.setBuffer(e,r),e=this.reader.cstring(),r=this.reader.cstring(),new s.ParameterStatusMessage(t,e,r)}parseBackendKeyData(e,t,r){return this.reader.setBuffer(e,r),e=this.reader.int32(),r=this.reader.int32(),new s.BackendKeyDataMessage(t,e,r)}parseAuthenticationResponse(e,t,r){this.reader.setBuffer(e,r);var n,i,o=this.reader.int32();const a={name:"authenticationOk",length:t};switch(o){case 0:break;case 3:8===a.length&&(a.name="authenticationCleartextPassword");break;case 5:if(12===a.length)return a.name="authenticationMD5Password",n=this.reader.bytes(4),new s.AuthenticationMD5Password(t,n);break;case 10:for(a.name="authenticationSASL",a.mechanisms=[];(i=this.reader.cstring())&&a.mechanisms.push(i),i;);break;case 11:a.name="authenticationSASLContinue",a.data=this.reader.string(t-8);break;case 12:a.name="authenticationSASLFinal",a.data=this.reader.string(t-8);break;default:throw new Error("Unknown authenticationOk message type "+o)}return a}parseErrorMessage(e,t,r,n){this.reader.setBuffer(e,r);const i={};let o=this.reader.string(1);for(;"\0"!==o;)i[o]=this.reader.cstring(),o=this.reader.string(1);e=i.M;const a="notice"===n?new s.NoticeMessage(t,e):new s.DatabaseError(e,t,n);return a.severity=i.S,a.code=i.C,a.detail=i.D,a.hint=i.H,a.position=i.P,a.internalPosition=i.p,a.internalQuery=i.q,a.where=i.W,a.schema=i.s,a.table=i.t,a.column=i.c,a.dataType=i.d,a.constraint=i.n,a.file=i.F,a.line=i.L,a.routine=i.R,a}}},9209:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=void 0;const n=r(246),s=new n.Writer,i=[],o=new n.Writer,a=Buffer.from([69,0,0,0,9,0,0,0,0,0]),c=(e,t)=>{var r=4+Buffer.byteLength(t)+1;const n=Buffer.allocUnsafe(1+r);return n[0]=e,n.writeInt32BE(r,1),n.write(t,5,"utf-8"),n[r]=0,n},h=s.addCString("P").flush(68),u=s.addCString("S").flush(68);r=e=>Buffer.from([e,0,0,0,4]);const l=r(72),f=r(83),d=r(88),p=r(99);t.serialize={startup:e=>{s.addInt16(3).addInt16(0);for(const t of Object.keys(e))s.addCString(t).addCString(e[t]);s.addCString("client_encoding").addCString("UTF8");var t=s.addCString("").flush(),r=t.length+4;return(new n.Writer).addInt32(r).add(t).flush()},password:e=>s.addCString(e).flush(112),requestSsl:()=>{const e=Buffer.allocUnsafe(8);return e.writeInt32BE(8,0),e.writeInt32BE(80877103,4),e},sendSASLInitialResponseMessage:function(e,t){return s.addCString(e).addInt32(Buffer.byteLength(t)).addString(t),s.flush(112)},sendSCRAMClientFinalMessage:function(e){return s.addString(e).flush(112)},query:e=>s.addCString(e).flush(81),parse:e=>{for(var t=e.name||"",r=(63<t.length&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",t,t.length),console.error("This can cause conflicts and silent errors executing queries")),e.types||i),n=r.length,o=s.addCString(t).addCString(e.text).addInt16(n),a=0;a<n;a++)o.addInt32(r[a]);return s.flush(80)},bind:(e={})=>{var t=e.portal||"",r=e.statement||"",n=e.binary||!1,a=e.values||i,c=a.length,h=(s.addCString(t).addCString(r),s.addInt16(c),a),u=e.valueMapper;for(let e=0;e<h.length;e++){var l=u?u(h[e],e):h[e];null==l?(s.addInt16(0),o.addInt32(-1)):l instanceof Buffer?(s.addInt16(1),o.addInt32(l.length),o.add(l)):(s.addInt16(0),o.addInt32(Buffer.byteLength(l)),o.addString(l))}return s.addInt16(c),s.add(o.flush()),s.addInt16(n?1:0),s.flush(66)},execute:e=>{if(!e||!e.portal&&!e.rows)return a;var t=e.portal||"",r=(e=e.rows||0,Buffer.byteLength(t)),n=4+r+1+4;const s=Buffer.allocUnsafe(1+n);return s[0]=69,s.writeInt32BE(n,1),s.write(t,5,"utf-8"),s[r+5]=0,s.writeUInt32BE(e,s.length-4),s},describe:e=>e.name?c(68,""+e.type+(e.name||"")):"P"===e.type?h:u,close:e=>(e=""+e.type+(e.name||""),c(67,e)),flush:()=>l,sync:()=>f,end:()=>d,copyData:e=>s.add(e).flush(100),copyDone:()=>p,copyFail:e=>c(102,e),cancel:(e,t)=>{const r=Buffer.allocUnsafe(16);return r.writeInt32BE(16,0),r.writeInt16BE(1234,4),r.writeInt16BE(5678,6),r.writeInt32BE(e,8),r.writeInt32BE(t,12),r}}},3619:(e,t,r)=>{var n=r(2980),s=r(1931),i=r(6169),o=(r=r(8078),t.getTypeParser=function(e,t){return o[t=t||"text"]&&o[t][e]||a},t.setTypeParser=function(e,t,r){"function"==typeof t&&(r=t,t="text"),o[t][e]=r},t.arrayParser=i,t.builtins=r,{text:{},binary:{}});function a(e){return String(e)}n.init((function(e,t){o.text[e]=t})),s.init((function(e,t){o.binary[e]=t}))},6169:(e,t,r)=>{var n=r(7315);e.exports={create:function(e,t){return{parse:function(){return n.parse(e,t)}}}}},1931:(e,t,r)=>{function n(e){return 1==d(e,1)?-1*(d(e,15,1,!0)+1):d(e,15,1)}function s(e){return 1==d(e,1)?-1*(d(e,31,1,!0)+1):d(e,31,1)}function i(e){return p(e,23,8)}function o(e){return p(e,52,11)}function a(e){var t=d(e,16,32);if(49152==t)return NaN;for(var r=Math.pow(1e4,d(e,16,16)),n=0,s=d(e,16),i=0;i<s;i++)n+=d(e,16,64+16*i)*r,r/=1e4;var o=Math.pow(10,d(e,16,48));return(0===t?1:-1)*Math.round(n*o)/o}function c(e,t){var r=d(t,1);return t=d(t,63,1),r=new Date((0===r?1:-1)*t/1e3+9466848e5),e||r.setTime(r.getTime()+6e4*r.getTimezoneOffset()),r.usec=t%1e3,r.getMicroSeconds=function(){return this.usec},r.setMicroSeconds=function(e){this.usec=e},r.getUTCMicroSeconds=function(){return this.usec},r}function h(e){for(var t=d(e,32),r=(d(e,32,32),d(e,32,64)),n=96,s=[],i=0;i<t;i++)s[i]=d(e,32,n),n=n+32+32;return function t(r,s){var i=[];if(1<r.length){for(var o=r.shift(),a=0;a<o;a++)i[a]=t(r,s);r.unshift(o)}else for(a=0;a<r[0];a++)i[a]=function(t){var r,s=d(e,32,n);return n+=32,4294967295==s?null:23==t||20==t?(r=d(e,8*s,n),n+=8*s,r):25==t?e.toString(this.encoding,n>>3,(n+=s<<3)>>3):void console.log("ERROR: ElementType not implemented: "+t)}(s);return i}(s,r)}function u(e){return e.toString("utf8")}function l(e){return null===e?null:0<d(e,8)}var f=r(6064),d=function(e,t,r,n,s){function i(e){return n?255&~e:e}n=n||!1,s=s||function(e,t,r){return e*Math.pow(2,r)+t};for(var o=(r=r||0)>>3,a=255,c=8-r%8,h=(t<c&&(a=255<<8-t&255,c=t),r&&(a>>=r%8),0),u=(8<=r%8+t&&(h=s(0,i(e[o])&a,c)),t+r>>3),l=1+o;l<u;l++)h=s(h,i(e[l]),8);return 0<(a=(t+r)%8)?s(h,i(e[u])>>8-a,a):h},p=function(e,t,r){var n=Math.pow(2,r-1)-1,s=d(e,1),i=d(e,r,1);if(0===i)return 0;var o=1;return e=d(e,t,r+1,!1,(function(e,t,r){0===e&&(e=1);for(var n=1;n<=r;n++)o/=2,0<(t&1<<r-n)&&(e+=o);return e})),i==Math.pow(2,r+1)-1?0===e?0===s?1/0:-1/0:NaN:(0===s?1:-1)*Math.pow(2,i-n)*e};e.exports={init:function(e){e(20,f),e(21,n),e(23,s),e(26,s),e(1700,a),e(700,i),e(701,o),e(16,l),e(1114,c.bind(null,!1)),e(1184,c.bind(null,!0)),e(1e3,h),e(1007,h),e(1016,h),e(1008,h),e(1009,h),e(25,u)}}},8078:e=>{e.exports={BOOL:16,BYTEA:17,CHAR:18,INT8:20,INT2:21,INT4:23,REGPROC:24,TEXT:25,OID:26,TID:27,XID:28,CID:29,JSON:114,XML:142,PG_NODE_TREE:194,SMGR:210,PATH:602,POLYGON:604,CIDR:650,FLOAT4:700,FLOAT8:701,ABSTIME:702,RELTIME:703,TINTERVAL:704,CIRCLE:718,MACADDR8:774,MONEY:790,MACADDR:829,INET:869,ACLITEM:1033,BPCHAR:1042,VARCHAR:1043,DATE:1082,TIME:1083,TIMESTAMP:1114,TIMESTAMPTZ:1184,INTERVAL:1186,TIMETZ:1266,BIT:1560,VARBIT:1562,NUMERIC:1700,REFCURSOR:1790,REGPROCEDURE:2202,REGOPER:2203,REGOPERATOR:2204,REGCLASS:2205,REGTYPE:2206,UUID:2950,TXID_SNAPSHOT:2970,PG_LSN:3220,PG_NDISTINCT:3361,PG_DEPENDENCIES:3402,TSVECTOR:3614,TSQUERY:3615,GTSVECTOR:3642,REGCONFIG:3734,REGDICTIONARY:3769,JSONB:3802,REGNAMESPACE:4089,REGROLE:4096}},2980:(e,t,r)=>{var n=r(7315),s=r(6169),i=r(3765),o=r(1055),a=r(3712);function c(e){return function(t){return null===t?t:e(t)}}function h(e){return null===e?e:"TRUE"===e||"t"===e||"true"===e||"y"===e||"yes"===e||"on"===e||"1"===e}function u(e){return e?n.parse(e,h):null}function l(e){return parseInt(e,10)}function f(e){return e?n.parse(e,c(l)):null}function d(e){return e?n.parse(e,c((function(e){return S(e).trim()}))):null}function p(e){return e?s.create(e,(function(e){return null!==e?x(e):e})).parse():null}function m(e){return e?s.create(e,(function(e){return null!==e?parseFloat(e):e})).parse():null}function g(e){return e?s.create(e).parse():null}function y(e){return e?s.create(e,(function(e){return null!==e?i(e):e})).parse():null}function b(e){return e?s.create(e,(function(e){return null!==e?o(e):e})).parse():null}function _(e){return e?n.parse(e,c(a)):null}function v(e){return parseInt(e,10)}function w(e){return e?n.parse(e,c(JSON.parse)):null}function E(e){if("<"!==e[0]&&"("!==e[1])return null;for(var t="(",r="",n=!1,s=2;s<e.length-1;s++)n||(t+=e[s]),")"===e[s]?n=!0:n&&","!==e[s]&&(r+=e[s]);var i=x(t);return i.radius=parseFloat(r),i}var S=function(e){var t=String(e);return/^\d+$/.test(t)?t:e},x=function(e){return"("!==e[0]?null:(e=e.substring(1,e.length-1).split(","),{x:parseFloat(e[0]),y:parseFloat(e[1])})};e.exports={init:function(e){e(20,S),e(21,v),e(23,v),e(26,v),e(700,parseFloat),e(701,parseFloat),e(16,h),e(1082,i),e(1114,i),e(1184,i),e(600,x),e(651,g),e(718,E),e(1e3,u),e(1001,_),e(1005,f),e(1007,f),e(1028,f),e(1016,d),e(1017,p),e(1021,m),e(1022,m),e(1231,m),e(1014,g),e(1015,g),e(1008,g),e(1009,g),e(1040,g),e(1041,g),e(1115,y),e(1182,y),e(1185,y),e(1186,o),e(1187,b),e(17,a),e(114,JSON.parse.bind(JSON)),e(3802,JSON.parse.bind(JSON)),e(199,w),e(3807,w),e(3907,g),e(2951,g),e(791,g),e(1183,g),e(1270,g)}}},7442:(e,t,r)=>{"use strict";var n=r(2361).EventEmitter,s=(r(3837),r(1262)),i=r(4615),o=r(8812),a=r(5701),c=r(8048),h=r(1134),u=r(7433),l=r(1964);class f extends n{constructor(e){super(),this.connectionParameters=new c(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication,e=e||{},this._Promise=e.Promise||global.Promise,this._types=new a(e.types),this._ending=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=e.connection||new l({stream:e.stream,ssl:this.connectionParameters.ssl,keepAlive:e.keepAlive||!1,keepAliveInitialDelayMillis:e.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=e.binary||u.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=e.connectionTimeoutMillis||0}_errorAllQueries(e){var t=t=>{process.nextTick((()=>{t.handleError(e,this.connection)}))};this.activeQuery&&(t(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(t),this.queryQueue.length=0}_connect(e){var t=this,r=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){const t=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick((()=>{e(t)}))}else this._connecting=!0,this.connectionTimeoutHandle,0<this._connectionTimeoutMillis&&(this.connectionTimeoutHandle=setTimeout((()=>{r._ending=!0,r.stream.destroy(new Error("timeout expired"))}),this._connectionTimeoutMillis)),this.host&&0===this.host.indexOf("/")?r.connect(this.host+"/.s.PGSQL."+this.port):r.connect(this.port,this.host),r.on("connect",(function(){t.ssl?r.requestSsl():r.startup(t.getStartupConf())})),r.on("sslconnect",(function(){r.startup(t.getStartupConf())})),this._attachListeners(r),r.once("end",(()=>{var e=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(e),this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(e):this._handleErrorEvent(e):this._connectionError||this._handleErrorEvent(e)),process.nextTick((()=>{this.emit("end")}))}))}connect(e){if(!e)return new this._Promise(((e,t)=>{this._connect((r=>{r?t(r):e()}))}));this._connect(e)}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){const t=this.connection;"function"==typeof this.password?this._Promise.resolve().then((()=>this.password())).then((r=>{if(void 0!==r){if("string"!=typeof r)return void t.emit("error",new TypeError("Password must be a string"));this.connectionParameters.password=this.password=r}else this.connectionParameters.password=this.password=null;e()})).catch((e=>{t.emit("error",e)})):null!==this.password?e():o(this.connectionParameters,(t=>{void 0!==t&&(this.connectionParameters.password=this.password=t),e()}))}_handleAuthCleartextPassword(e){this._checkPgPass((()=>{this.connection.password(this.password)}))}_handleAuthMD5Password(e){this._checkPgPass((()=>{var t=s.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(t)}))}_handleAuthSASL(e){this._checkPgPass((()=>{this.saslSession=i.startSession(e.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}))}_handleAuthSASLContinue(e){i.continueSession(this.saslSession,this.password,e.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}_handleAuthSASLFinal(e){i.finalizeSession(this.saslSession,e.data),this.saslSession=null}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));const t=this.activeQuery;this.activeQuery=null,this.readyForQuery=!0,t&&t.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);const t=this.activeQuery;t?(this.activeQuery=null,t.handleError(e,this.connection)):this._handleErrorEvent(e)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(e){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){var e=this.connectionParameters,t={user:e.user,database:e.database},r=e.application_name||e.fallback_application_name;return r&&(t.application_name=r),e.replication&&(t.replication=""+e.replication),e.statement_timeout&&(t.statement_timeout=String(parseInt(e.statement_timeout,10))),e.idle_in_transaction_session_timeout&&(t.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(t.options=e.options),t}cancel(e,t){var r;e.activeQuery===t?(r=this.connection,this.host&&0===this.host.indexOf("/")?r.connect(this.host+"/.s.PGSQL."+this.port):r.connect(this.port,this.host),r.on("connect",(function(){r.cancel(e.processID,e.secretKey)}))):-1!==e.queryQueue.indexOf(t)&&e.queryQueue.splice(e.queryQueue.indexOf(t),1)}setTypeParser(e,t,r){return this._types.setTypeParser(e,t,r)}getTypeParser(e,t){return this._types.getTypeParser(e,t)}escapeIdentifier(e){return'"'+e.replace(/"/g,'""')+'"'}escapeLiteral(e){for(var t=!1,r="'",n=0;n<e.length;n++){var s=e[n];"'"===s?r+=s+s:"\\"===s?(r+=s+s,t=!0):r+=s}return r+="'",!0===t?" E"+r:r}_pulseQueryQueue(){if(!0===this.readyForQuery)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;const e=this.activeQuery.submit(this.connection);e&&process.nextTick((()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()}))}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,t,r){var n,s,i,o,a;if(null==e)throw new TypeError("Client was passed a null or undefined query");return"function"==typeof e.submit?(i=e.query_timeout||this.connectionParameters.query_timeout,s=n=e,"function"==typeof t&&(n.callback=n.callback||t)):(i=this.connectionParameters.query_timeout,(n=new h(e,t,r)).callback||(s=new this._Promise(((e,t)=>{n.callback=(r,n)=>r?t(r):e(n)})))),i&&(a=n.callback,o=setTimeout((()=>{var e=new Error("Query read timeout"),t=(process.nextTick((()=>{n.handleError(e,this.connection)})),a(e),n.callback=()=>{},this.queryQueue.indexOf(n));-1<t&&this.queryQueue.splice(t,1),this._pulseQueryQueue()}),i),n.callback=(e,t)=>{clearTimeout(o),a(e,t)}),this.binary&&!n.binary&&(n.binary=!0),n._result&&!n._result._types&&(n._result._types=this._types),this._queryable?this._ending?process.nextTick((()=>{n.handleError(new Error("Client was closed and is not queryable"),this.connection)})):(this.queryQueue.push(n),this._pulseQueryQueue()):process.nextTick((()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)})),s}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting){if(!e)return this._Promise.resolve();e()}if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),!e)return new this._Promise((e=>{this.connection.once("end",e)}));this.connection.once("end",e)}}f.Query=h,e.exports=f},8048:(e,t,r)=>{"use strict";function n(e,t,r){return void 0===r?r=process.env["PG"+e.toUpperCase()]:!1!==r&&(r=process.env[r]),t[e]||r||a[e]}function s(e){return"'"+(""+e).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"}function i(e,t,r){null!=(t=t[r])&&e.push(r+"="+s(t))}var o=r(9523),a=r(7433),c=r(5697).parse;e.exports=class{constructor(e){(e="string"==typeof e?c(e):e||{}).connectionString&&(e=Object.assign({},e,c(e.connectionString))),this.user=n("user",e),this.database=n("database",e),void 0===this.database&&(this.database=this.user),this.port=parseInt(n("port",e),10),this.host=n("host",e),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:n("password",e)}),this.binary=n("binary",e),this.options=n("options",e),this.ssl=void 0===e.ssl?function(){switch(process.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return a.ssl}():e.ssl,"string"==typeof this.ssl&&"true"===this.ssl&&(this.ssl=!0),"no-verify"===this.ssl&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=n("client_encoding",e),this.replication=n("replication",e),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=n("application_name",e,"PGAPPNAME"),this.fallback_application_name=n("fallback_application_name",e,!1),this.statement_timeout=n("statement_timeout",e,!1),this.idle_in_transaction_session_timeout=n("idle_in_transaction_session_timeout",e,!1),this.query_timeout=n("query_timeout",e,!1),void 0===e.connectionTimeoutMillis?this.connect_timeout=process.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(e.connectionTimeoutMillis/1e3),!1===e.keepAlive?this.keepalives=0:!0===e.keepAlive&&(this.keepalives=1),"number"==typeof e.keepAliveInitialDelayMillis&&(this.keepalives_idle=Math.floor(e.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(e){var t=[],r=(i(t,this,"user"),i(t,this,"password"),i(t,this,"port"),i(t,this,"application_name"),i(t,this,"fallback_application_name"),i(t,this,"connect_timeout"),i(t,this,"options"),"object"==typeof this.ssl?this.ssl:this.ssl?{sslmode:this.ssl}:{});if(i(t,r,"sslmode"),i(t,r,"sslca"),i(t,r,"sslkey"),i(t,r,"sslcert"),i(t,r,"sslrootcert"),this.database&&t.push("dbname="+s(this.database)),this.replication&&t.push("replication="+s(this.replication)),this.host&&t.push("host="+s(this.host)),this.isDomainSocket)return e(null,t.join(" "));this.client_encoding&&t.push("client_encoding="+s(this.client_encoding)),o.lookup(this.host,(function(r,n){return r?e(r,null):(t.push("hostaddr="+s(n)),e(null,t.join(" ")))}))}}},1964:(e,t,r)=>{"use strict";var n=r(1808),s=r(2361).EventEmitter;const{parse:i,serialize:o}=r(8152),a=o.flush(),c=o.sync(),h=o.end();e.exports=class extends s{constructor(e){super(),this.stream=(e=e||{}).stream||new n.Socket,this._keepAlive=e.keepAlive,this._keepAliveInitialDelayMillis=e.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=e.ssl||!1,this._ending=!1,this._emitMessage=!1;var t=this;this.on("newListener",(function(e){"message"===e&&(t._emitMessage=!0)}))}connect(e,t){var s=this;function i(e){s._ending&&("ECONNRESET"===e.code||"EPIPE"===e.code)||s.emit("error",e)}if(this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(e,t),this.stream.once("connect",(function(){s._keepAlive&&s.stream.setKeepAlive(!0,s._keepAliveInitialDelayMillis),s.emit("connect")})),this.stream.on("error",i),this.stream.on("close",(function(){s.emit("end")})),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",(function(e){switch(e.toString("utf8")){case"S":break;case"N":return s.stream.end(),s.emit("error",new Error("The server does not support SSL connections"));default:return s.stream.end(),s.emit("error",new Error("There was an error establishing an SSL connection"))}e=r(4404);const o={socket:s.stream};!0!==s.ssl&&(Object.assign(o,s.ssl),"key"in s.ssl&&(o.key=s.ssl.key)),0===n.isIP(t)&&(o.servername=t);try{s.stream=e.connect(o)}catch(e){return s.emit("error",e)}s.attachListeners(s.stream),s.stream.on("error",i),s.emit("sslconnect")}))}attachListeners(e){e.on("end",(()=>{this.emit("end")})),i(e,(e=>{var t="error"===e.name?"errorMessage":e.name;this._emitMessage&&this.emit("message",e),this.emit(t,e)}))}requestSsl(){this.stream.write(o.requestSsl())}startup(e){this.stream.write(o.startup(e))}cancel(e,t){this._send(o.cancel(e,t))}password(e){this._send(o.password(e))}sendSASLInitialResponseMessage(e,t){this._send(o.sendSASLInitialResponseMessage(e,t))}sendSCRAMClientFinalMessage(e){this._send(o.sendSCRAMClientFinalMessage(e))}_send(e){return!!this.stream.writable&&this.stream.write(e)}query(e){this._send(o.query(e))}parse(e){this._send(o.parse(e))}bind(e){this._send(o.bind(e))}execute(e){this._send(o.execute(e))}flush(){this.stream.writable&&this.stream.write(a)}sync(){this._ending=!0,this._send(a),this._send(c)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,this._connecting&&this.stream.writable)return this.stream.write(h,(()=>{this.stream.end()}));this.stream.end()}close(e){this._send(o.close(e))}describe(e){this._send(o.describe(e))}sendCopyFromChunk(e){this._send(o.copyData(e))}endCopyFrom(){this._send(o.copyDone())}sendCopyFail(e){this._send(o.copyFail(e))}}},7433:(e,t,r)=>{"use strict";e.exports={host:"localhost",user:"win32"===process.platform?process.env.USERNAME:process.env.USER,database:void 0,password:null,connectionString:void 0,port:5432,rows:0,binary:!1,max:10,idleTimeoutMillis:3e4,client_encoding:"",ssl:!1,application_name:void 0,fallback_application_name:void 0,options:void 0,parseInputDatesAsUTC:!1,statement_timeout:!1,idle_in_transaction_session_timeout:!1,query_timeout:!1,connect_timeout:0,keepalives:1,keepalives_idle:0};var n=r(3619),s=n.getTypeParser(20,"text"),i=n.getTypeParser(1016,"text");e.exports.__defineSetter__("parseInt8",(function(e){n.setTypeParser(20,"text",e?n.getTypeParser(23,"text"):s),n.setTypeParser(1016,"text",e?n.getTypeParser(1007,"text"):i)}))},8955:(e,t,r)=>{"use strict";var n=r(7442),s=r(7433),i=r(1964),o=r(5546);const a=r(8152).DatabaseError;function c(e){var t;this.defaults=s,this.Client=e,this.Query=this.Client.Query,this.Pool=(t=this.Client,class extends o{constructor(e){super(e,t)}}),this._pools=[],this.Connection=i,this.types=r(3619),this.DatabaseError=a}void 0!==process.env.NODE_PG_FORCE_NATIVE?e.exports=new c(r(6221)):(e.exports=new c(n),Object.defineProperty(e.exports,"native",{configurable:!0,enumerable:!1,get(){var t=null;try{t=new c(r(6221))}catch(t){if("MODULE_NOT_FOUND"!==t.code)throw t}return Object.defineProperty(e.exports,"native",{value:t}),t}}))},6033:(e,t,r)=>{"use strict";var n=r(Object(function(){var e=new Error("Cannot find module 'pg-native'");throw e.code="MODULE_NOT_FOUND",e}())),s=r(5701),i=(r(2466),r(2361).EventEmitter),o=r(3837),a=r(8048),c=r(7839);(r=e.exports=function(e){i.call(this),this._Promise=(e=e||{}).Promise||global.Promise,this._types=new s(e.types),this.native=new n({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0,e=this.connectionParameters=new a(e),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}}).Query=c,o.inherits(r,i),r.prototype._errorAllQueries=function(e){var t=t=>{process.nextTick((()=>{t.native=this.native,t.handleError(e)}))};this._hasActiveQuery()&&(t(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(t),this._queryQueue.length=0},r.prototype._connect=function(e){var t=this;this._connecting?process.nextTick((()=>e(new Error("Client has already been connected. You cannot reuse a client.")))):(this._connecting=!0,this.connectionParameters.getLibpqConnectionString((function(r,n){if(r)return e(r);t.native.connect(n,(function(r){if(r)return t.native.end(),e(r);t._connected=!0,t.native.on("error",(function(e){t._queryable=!1,t._errorAllQueries(e),t.emit("error",e)})),t.native.on("notification",(function(e){t.emit("notification",{channel:e.relname,payload:e.extra})})),t.emit("connect"),t._pulseQueryQueue(!0),e()}))})))},r.prototype.connect=function(e){if(!e)return new this._Promise(((e,t)=>{this._connect((r=>{r?t(r):e()}))}));this._connect(e)},r.prototype.query=function(e,t,r){var n,s,i,o,a;if(null==e)throw new TypeError("Client was passed a null or undefined query");if("function"==typeof e.submit)i=e.query_timeout||this.connectionParameters.query_timeout,s=n=e,"function"==typeof t&&(e.callback=t);else if(i=this.connectionParameters.query_timeout,!(n=new c(e,t,r)).callback){let e,t;s=new this._Promise(((r,n)=>{e=r,t=n})),n.callback=(r,n)=>r?t(r):e(n)}return i&&(a=n.callback,o=setTimeout((()=>{var e=new Error("Query read timeout"),t=(process.nextTick((()=>{n.handleError(e,this.connection)})),a(e),n.callback=()=>{},this._queryQueue.indexOf(n));-1<t&&this._queryQueue.splice(t,1),this._pulseQueryQueue()}),i),n.callback=(e,t)=>{clearTimeout(o),a(e,t)}),this._queryable?this._ending?(n.native=this.native,process.nextTick((()=>{n.handleError(new Error("Client was closed and is not queryable"))}))):(this._queryQueue.push(n),this._pulseQueryQueue()):(n.native=this.native,process.nextTick((()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"))}))),s},r.prototype.end=function(e){var t,r=this;return this._ending=!0,this._connected||this.once("connect",this.end.bind(this,e)),e||(t=new this._Promise((function(t,r){e=e=>e?r(e):t()}))),this.native.end((function(){r._errorAllQueries(new Error("Connection terminated")),process.nextTick((()=>{r.emit("end"),e&&e()}))})),t},r.prototype._hasActiveQuery=function(){return this._activeQuery&&"error"!==this._activeQuery.state&&"end"!==this._activeQuery.state},r.prototype._pulseQueryQueue=function(e){var t,r;this._connected&&!this._hasActiveQuery()&&((t=this._queryQueue.shift())?((this._activeQuery=t).submit(this),r=this,t.once("_done",(function(){r._pulseQueryQueue()}))):e||this.emit("drain"))},r.prototype.cancel=function(e){this._activeQuery===e?this.native.cancel((function(){})):-1!==this._queryQueue.indexOf(e)&&this._queryQueue.splice(this._queryQueue.indexOf(e),1)},r.prototype.ref=function(){},r.prototype.unref=function(){},r.prototype.setTypeParser=function(e,t,r){return this._types.setTypeParser(e,t,r)},r.prototype.getTypeParser=function(e,t){return this._types.getTypeParser(e,t)}},6221:(e,t,r)=>{"use strict";e.exports=r(6033)},7839:(e,t,r)=>{"use strict";var n=r(2361).EventEmitter,s=r(3837),i=r(1262),o=(r=e.exports=function(e,t,r){n.call(this),e=i.normalizeQueryConfig(e,t,r),this.text=e.text,this.values=e.values,this.name=e.name,this.callback=e.callback,this.state="new",this._arrayMode="array"===e.rowMode,this._emitRowEvents=!1,this.on("newListener",function(e){"row"===e&&(this._emitRowEvents=!0)}.bind(this))},s.inherits(r,n),{sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"});r.prototype.handleError=function(e){var t=this.native.pq.resultErrorFields();if(t)for(var r in t)e[o[r]||r]=t[r];this.callback?this.callback(e):this.emit("error",e),this.state="error"},r.prototype.then=function(e,t){return this._getPromise().then(e,t)},r.prototype.catch=function(e){return this._getPromise().catch(e)},r.prototype._getPromise=function(){return this._promise||(this._promise=new Promise(function(e,t){this._once("end",e),this._once("error",t)}.bind(this))),this._promise},r.prototype.submit=function(e){this.state="running";var t,r=this,n=(this.native=e.native,e.native.arrayMode=this._arrayMode,function(t,n,s){if(e.native.arrayMode=!1,setImmediate((function(){r.emit("_done")})),t)return r.handleError(t);r._emitRowEvents&&(1<s.length?n.forEach(((e,t)=>{e.forEach((e=>{r.emit("row",e,s[t])}))})):n.forEach((function(e){r.emit("row",e,s)}))),r.state="end",r.emit("end",s),r.callback&&r.callback(null,s)});if(process.domain&&(n=process.domain.bind(n)),this.name)return 63<this.name.length&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries")),t=(this.values||[]).map(i.prepareValue),e.namedQueries[this.name]?this.text&&e.namedQueries[this.name]!==this.text?(s=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`),n(s)):e.native.execute(this.name,t,n):e.native.prepare(this.name,this.text,t.length,(function(s){return s?n(s):(e.namedQueries[r.name]=r.text,r.native.execute(r.name,t,n))}));if(this.values){if(!Array.isArray(this.values))return s=new Error("Query values must be an array"),n(s);var s=this.values.map(i.prepareValue);e.native.query(this.text,s,n)}else e.native.query(this.text,n)}},1134:(e,t,r)=>{"use strict";var n=r(2361).EventEmitter;const s=r(3758),i=r(1262);e.exports=class extends n{constructor(e,t,r){super(),e=i.normalizeQueryConfig(e,t,r),this.text=e.text,this.values=e.values,this.rows=e.rows,this.types=e.types,this.name=e.name,this.binary=e.binary,this.portal=e.portal||"",this.callback=e.callback,this._rowMode=e.rowMode,process.domain&&e.callback&&(this.callback=process.domain.bind(e.callback)),this._result=new s(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return!!this.name||!!this.rows||!!this.text&&!!this.values&&0<this.values.length}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new s(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(e){this._checkForMultirow(),this._result.addFields(e.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(e){let t;if(!this._canceledDueToError){try{t=this._result.parseRow(e.fields)}catch(e){return void(this._canceledDueToError=e)}this.emit("row",t,this._result),this._accumulateRows&&this._result.addRow(t)}}handleCommandComplete(e,t){this._checkForMultirow(),this._result.addCommandComplete(e),this.rows&&t.sync()}handleEmptyQuery(e){this.rows&&e.sync()}handleError(e,t){if(this._canceledDueToError&&(e=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(e);this.emit("error",e)}handleReadyForQuery(e){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,e);this.callback&&this.callback(null,this._results),this.emit("end",this._results)}submit(e){if("string"!=typeof this.text&&"string"!=typeof this.name)return new Error("A query must have either text or a name. Supplying neither is unsupported.");var t=e.parsedStatements[this.name];return this.text&&t&&this.text!==t?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(e):e.query(this.text),null)}hasBeenParsed(e){return this.name&&e.parsedStatements[this.name]}handlePortalSuspended(e){this._getRows(e,this.rows)}_getRows(e,t){e.execute({portal:this.portal,rows:t}),t?e.flush():e.sync()}prepare(e){this.isPreparedStatement=!0,this.hasBeenParsed(e)||e.parse({text:this.text,name:this.name,types:this.types});try{e.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:i.prepareValue})}catch(t){return void this.handleError(t,e)}e.describe({type:"P",name:this.portal||""}),this._getRows(e,this.rows)}handleCopyInResponse(e){e.sendCopyFail("No source stream defined")}handleCopyData(e,t){}}},3758:(e,t,r)=>{"use strict";var n=r(3619),s=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/;e.exports=class{constructor(e,t){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=t,this.RowCtor=null,this.rowAsArray="array"===e,this.rowAsArray&&(this.parseRow=this._parseRowAsArray)}addCommandComplete(e){(e=e.text?s.exec(e.text):s.exec(e.command))&&(this.command=e[1],e[3]?(this.oid=parseInt(e[2],10),this.rowCount=parseInt(e[3],10)):e[2]&&(this.rowCount=parseInt(e[2],10)))}_parseRowAsArray(e){for(var t=new Array(e.length),r=0,n=e.length;r<n;r++){var s=e[r];t[r]=null!==s?this._parsers[r](s):null}return t}parseRow(e){for(var t={},r=0,n=e.length;r<n;r++){var s=e[r];t[this.fields[r].name]=null!==s?this._parsers[r](s):null}return t}addRow(e){this.rows.push(e)}addFields(e){this.fields=e,this.fields.length&&(this._parsers=new Array(e.length));for(var t=0;t<e.length;t++){var r=e[t];this._types?this._parsers[t]=this._types.getTypeParser(r.dataTypeID,r.format||"text"):this._parsers[t]=n.getTypeParser(r.dataTypeID,r.format||"text")}}}},4615:(e,t,r)=>{"use strict";const n=r(6113);function s(e){return/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(e)}function i(e){if("string"!=typeof e)throw new TypeError("SASL: attribute pairs text must be a string");return new Map(e.split(",").map((e=>{if(/^.=/.test(e))return[e[0],e.substring(2)];throw new Error("SASL: Invalid attribute pair entry")})))}function o(e,t){if(!Buffer.isBuffer(e))throw new TypeError("first argument must be a Buffer");if(!Buffer.isBuffer(t))throw new TypeError("second argument must be a Buffer");if(e.length!==t.length)throw new Error("Buffer lengths must match");if(0===e.length)throw new Error("Buffers cannot be empty");return Buffer.from(e.map(((r,n)=>e[n]^t[n])))}function a(e,t){return n.createHmac("sha256",e).update(t).digest()}e.exports={startSession:function(e){if(-1===e.indexOf("SCRAM-SHA-256"))throw new Error("SASL: Only mechanism SCRAM-SHA-256 is currently supported");return{mechanism:"SCRAM-SHA-256",clientNonce:e=n.randomBytes(18).toString("base64"),response:"n,,n=*,r="+e,message:"SASLInitialResponse"}},continueSession:function(e,t,r){if("SASLInitialResponse"!==e.message)throw new Error("SASL: Last message was not SASLInitialResponse");if("string"!=typeof t)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string");if("string"!=typeof r)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: serverData must be a string");const c=function(e){const t=i(e),r=t.get("r");if(!r)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing");if(!function(e){if("string"==typeof e)return e.split("").map(((t,r)=>e.charCodeAt(r))).every((e=>33<=e&&e<=43||45<=e&&e<=126));throw new TypeError("SASL: text must be a string")}(r))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce must only contain printable characters");if(!(e=t.get("s")))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing");if(!s(e))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt must be base64");var n=t.get("i");if(!n)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: iteration missing");if(!/^[1-9][0-9]*$/.test(n))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: invalid iteration count");return{nonce:r,salt:e,iteration:n=parseInt(n,10)}}(r);if(!c.nonce.startsWith(e.clientNonce))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");if(c.nonce.length===e.clientNonce.length)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short");r=function(e,t,r){for(var n=a(e,Buffer.concat([t,Buffer.from([0,0,0,1])])),s=n,i=0;i<r-1;i++)s=o(s,n=a(e,n));return s}(t,Buffer.from(c.salt,"base64"),c.iteration);var h=(h=t=a(r,"Client Key"),n.createHash("sha256").update(h).digest()),u="n=*,r="+e.clientNonce,l="r="+c.nonce+",s="+c.salt+",i="+c.iteration,f="c=biws,r="+c.nonce;l=o(t,a(h,u=u+","+l+","+f)).toString("base64"),t=a(r,"Server Key"),h=a(t,u),e.message="SASLResponse",e.serverSignature=h.toString("base64"),e.response=f+",p="+l},finalizeSession:function(e,t){if("SASLResponse"!==e.message)throw new Error("SASL: Last message was not SASLResponse");if("string"!=typeof t)throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: serverData must be a string");if((t=function(e){const t=i(e).get("v");if(!t)throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature is missing");if(!s(t))throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature must be base64");return{serverSignature:t}}(t).serverSignature)!==e.serverSignature)throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature does not match")}}},5701:(e,t,r)=>{"use strict";var n=r(3619);function s(e){this._types=e||n,this.text={},this.binary={}}s.prototype.getOverrides=function(e){switch(e){case"text":return this.text;case"binary":return this.binary;default:return{}}},s.prototype.setTypeParser=function(e,t,r){"function"==typeof t&&(r=t,t="text"),this.getOverrides(t)[e]=r},s.prototype.getTypeParser=function(e,t){return this.getOverrides(t=t||"text")[e]||this._types.getTypeParser(e,t)},e.exports=s},1262:(e,t,r)=>{"use strict";const n=r(6113),s=r(7433);var i=function(e,t){if(null==e)return null;if(e instanceof Buffer)return e;var r,n,a;if(ArrayBuffer.isView(e))return(r=Buffer.from(e.buffer,e.byteOffset,e.byteLength)).length===e.byteLength?r:r.slice(e.byteOffset,e.byteOffset+e.byteLength);if(e instanceof Date)return s.parseInputDatesAsUTC?(a=o(a=(n=(a=(r=e).getUTCFullYear())<1)?Math.abs(a)+1:a,4)+"-"+o(r.getUTCMonth()+1,2)+"-"+o(r.getUTCDate(),2)+"T"+o(r.getUTCHours(),2)+":"+o(r.getUTCMinutes(),2)+":"+o(r.getUTCSeconds(),2)+"."+o(r.getUTCMilliseconds(),3),a+="+00:00",n&&(a+=" BC"),a):(a=-(n=e).getTimezoneOffset(),h=o(h=(c=(h=n.getFullYear())<1)?Math.abs(h)+1:h,4)+"-"+o(n.getMonth()+1,2)+"-"+o(n.getDate(),2)+"T"+o(n.getHours(),2)+":"+o(n.getMinutes(),2)+":"+o(n.getSeconds(),2)+"."+o(n.getMilliseconds(),3),a<0?(h+="-",a*=-1):h+="+",h+=o(Math.floor(a/60),2)+":"+o(a%60,2),c&&(h+=" BC"),h);if(Array.isArray(e))return function e(t){for(var r="{",n=0;n<t.length;n++)0<n&&(r+=","),null===t[n]||void 0===t[n]?r+="NULL":Array.isArray(t[n])?r+=e(t[n]):t[n]instanceof Buffer?r+="\\\\x"+t[n].toString("hex"):r+='"'+i(t[n]).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"';return r+"}"}(e);if("object"!=typeof e)return e.toString();var c=e,h=t;if(c&&"function"==typeof c.toPostgres){if(-1!==(h=h||[]).indexOf(c))throw new Error('circular reference detected while preparing "'+c+'" for query');return h.push(c),i(c.toPostgres(i),h)}return JSON.stringify(c)};function o(e,t){for(e=""+e;e.length<t;)e="0"+e;return e}function a(e){return n.createHash("md5").update(e,"utf-8").digest("hex")}e.exports={prepareValue:function(e){return i(e)},normalizeQueryConfig:function(e,t,r){return e="string"==typeof e?{text:e}:e,t&&("function"==typeof t?e.callback=t:e.values=t),r&&(e.callback=r),e},postgresMd5PasswordHash:function(e,t,r){return t=a(t+e),"md5"+a(Buffer.concat([Buffer.from(t),r]))},md5:a}},8242:(e,t,r)=>{"use strict";var n=r(1017),s=r(2781).Stream,i=r(861),o=r(3837),a="win32"===process.platform,c=process.stderr,h=["host","port","database","user","password"],u=h.length,l=h[u-1];function f(){var e;c instanceof s&&!0===c.writable&&(e=Array.prototype.slice.call(arguments).concat("\n"),c.write(o.format.apply(o,e)))}Object.defineProperty(e.exports,"isWin",{get:function(){return a},set:function(e){a=e}}),e.exports.warnTo=function(e){var t=c;return c=e,t},e.exports.getFileName=function(e){return(e=e||process.env).PGPASSFILE||(a?n.join(e.APPDATA||"./","postgresql","pgpass.conf"):n.join(e.HOME||"./",".pgpass"))},e.exports.usePgPass=function(e,t){return!(Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")||!a&&(t=t||"<unkn>",32768!=(61440&e.mode)?(f('WARNING: password file "%s" is not a plain file',t),1):63&e.mode&&(f('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',t),1)))};var d=e.exports.match=function(e,t){return h.slice(0,-1).reduce((function(r,n,s){return 1==s&&Number(e[n]||5432)===Number(t[n])?r&&!0:r&&("*"===t[n]||t[n]===e[n])}),!0)},p=(e.exports.getPassword=function(e,t,r){var n,s=t.pipe(i());function o(e){t.destroy(),f("WARNING: error on reading file: %s",e),r(void 0)}t.on("error",o),s.on("data",(function(t){(t=p(t))&&m(t)&&d(e,t)&&(n=t[l],s.end())})).on("end",(function(){t.destroy(),r(n)})).on("error",o)},e.exports.parseLine=function(e){if(e.length<11||e.match(/^\s+#/))return null;for(var t,r,n=0,s=0,i={},o=function(t,r,n){r=e.substring(r,n),Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(r=r.replace(/\\([:\\])/g,"$1")),i[h[t]]=r},a=0;a<e.length-1;a+=1){if(t=e.charAt(a+1),r=e.charAt(a),n==u-1){o(n,s);break}0<=a&&":"==t&&"\\"!==r&&(o(n,s,a+1),s=a+2,n+=1)}return i=Object.keys(i).length===u?i:null}),m=e.exports.isValidEntry=function(e){for(var t={0:function(e){return 0<e.length},1:function(e){return"*"===e||(e=Number(e),isFinite(e)&&0<e&&e<9007199254740992&&Math.floor(e)===e)},2:function(e){return 0<e.length},3:function(e){return 0<e.length},4:function(e){return 0<e.length}},r=0;r<h.length;r+=1)if(!(0,t[r])(e[h[r]]||""))return!1;return!0}},8812:(e,t,r)=>{"use strict";r(1017);var n=r(7147),s=r(8242);e.exports=function(e,t){var r=s.getFileName();n.stat(r,(function(i,o){if(i||!s.usePgPass(o,r))return t(void 0);i=n.createReadStream(r),s.getPassword(e,i,t)}))},e.exports.warnTo=s.warnTo},7315:(e,t)=>{"use strict";t.parse=function(e,t){return new r(e,t).parse()};class r{constructor(e,t){this.source=e,this.transform=t||n,this.position=0,this.entries=[],this.recorded=[],this.dimension=0}isEof(){return this.position>=this.source.length}nextCharacter(){var e=this.source[this.position++];return"\\"===e?{value:this.source[this.position++],escaped:!0}:{value:e,escaped:!1}}record(e){this.recorded.push(e)}newEntry(e){var t;(0<this.recorded.length||e)&&(null!==(t="NULL"!==(t=this.recorded.join(""))||e?t:null)&&(t=this.transform(t)),this.entries.push(t),this.recorded=[])}consumeDimensions(){if("["===this.source[0])for(;!this.isEof()&&"="!==this.nextCharacter().value;);}parse(e){var t,n;for(this.consumeDimensions();!this.isEof();)if("{"!==(t=this.nextCharacter()).value||n){if("}"!==t.value||n)'"'!==t.value||t.escaped?","!==t.value||n?this.record(t.value):this.newEntry():(n&&this.newEntry(!0),n=!n);else if(this.dimension--,!this.dimension&&(this.newEntry(),e))return this.entries}else this.dimension++,1<this.dimension&&(t=new r(this.source.substr(this.position-1),this.transform),this.entries.push(t.parse(!0)),this.position+=t.position-2);if(0!==this.dimension)throw new Error("array dimension not balanced");return this.entries}}function n(e){return e}},3712:e=>{"use strict";e.exports=function(e){if(/^\\x/.test(e))return new Buffer(e.substr(2),"hex");for(var t="",r=0;r<e.length;)if("\\"!==e[r])t+=e[r],++r;else if(/[0-7]{3}/.test(e.substr(r+1,3)))t+=String.fromCharCode(parseInt(e.substr(r+1,3),8)),r+=4;else{for(var n=1;r+n<e.length&&"\\"===e[r+n];)n++;for(var s=0;s<Math.floor(n/2);++s)t+="\\";r+=2*Math.floor(n/2)}return new Buffer(t,"binary")}},3765:e=>{"use strict";var t=/(\d{1,})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})(\.\d{1,})?.*?( BC)?$/,r=/^(\d{1,})-(\d{2})-(\d{2})( BC)?$/,n=/([Z+-])(\d{2})?:?(\d{2})?:?(\d{2})?/,s=/^-?infinity$/;function i(e){return-(e-1)}function o(e){return 0<=e&&e<100}e.exports=function(e){if(s.test(e))return Number(e.replace("i","I"));if(!(p=t.exec(e)))return function(e){var t,n;if(e=r.exec(e))return t=parseInt(e[1],10),e[4]&&(t=i(t)),n=parseInt(e[2],10)-1,e=e[3],n=new Date(t,n,e),o(t)&&n.setFullYear(t),n}(e)||null;var a,c=!!p[8],h=parseInt(p[1],10),u=(c&&(h=i(h)),c=parseInt(p[2],10)-1,p[3]),l=parseInt(p[4],10),f=parseInt(p[5],10),d=parseInt(p[6],10),p=(p=p[7])?1e3*parseFloat(p):0;return e=function(e){if(e.endsWith("+00"))return 0;if(e=n.exec(e.split(" ")[1])){var t=e[1];return"Z"===t?0:(t="-"===t?-1:1,(3600*parseInt(e[2],10)+60*parseInt(e[3]||0,10)+parseInt(e[4]||0,10))*t*1e3)}}(e),null!=e?(a=new Date(Date.UTC(h,c,u,l,f,d,p)),o(h)&&a.setUTCFullYear(h),0!==e&&a.setTime(a.getTime()-e)):(a=new Date(h,c,u,l,f,d,p),o(h)&&a.setFullYear(h)),a}},1055:(e,t,r)=>{"use strict";var n=r(9820);function s(e){if(!(this instanceof s))return new s(e);n(this,function(e){if(!e)return{};var t=h.exec(e),r="-"===t[8];return Object.keys(u).reduce((function(e,n){var s=u[n];return(s=(s=t[s])&&("milliseconds"===n?function(e){return e+="000000".slice(e.length),parseInt(e,10)/1e3}(s):parseInt(s,10)))&&(r&&~l.indexOf(n)&&(s*=-1),e[n]=s),e}),{})}(e))}e.exports=s;var i=["seconds","minutes","hours","days","months","years"],o=(s.prototype.toPostgres=function(){var e=i.filter(this.hasOwnProperty,this);return this.milliseconds&&e.indexOf("seconds")<0&&e.push("seconds"),0===e.length?"0":e.map((function(e){var t=this[e]||0;return(t="seconds"===e&&this.milliseconds?(t+this.milliseconds/1e3).toFixed(6).replace(/\.?0+$/,""):t)+" "+e}),this).join(" ")},{years:"Y",months:"M",days:"D",hours:"H",minutes:"M",seconds:"S"}),a=["years","months","days"],c=["hours","minutes","seconds"],h=(s.prototype.toISOString=s.prototype.toISO=function(){return"P"+a.map(e,this).join("")+"T"+c.map(e,this).join("");function e(e){var t=this[e]||0;return(t="seconds"===e&&this.milliseconds?(t+this.milliseconds/1e3).toFixed(6).replace(/0+$/,""):t)+o[e]}},r="([+-]?\\d+)",new RegExp([r+"\\s+years?",r+"\\s+mons?",r+"\\s+days?","([+-])?([\\d]*):(\\d\\d):(\\d\\d)\\.?(\\d{1,6})?"].map((function(e){return"("+e+")?"})).join("\\s*"))),u={years:2,months:4,days:6,hours:9,minutes:10,seconds:11,milliseconds:12},l=["hours","minutes","seconds","milliseconds"]},861:(e,t,r)=>{"use strict";const n=r(2781).Transform,s=r(1576).StringDecoder,i=Symbol("last"),o=Symbol("decoder");function a(e,t,r){let n;if(this.overflow){if(1===(n=this[o].write(e).split(this.matcher)).length)return r();n.shift(),this.overflow=!1}else this[i]+=this[o].write(e),n=this[i].split(this.matcher);this[i]=n.pop();for(let t=0;t<n.length;t++)try{h(this,this.mapper(n[t]))}catch(e){return r(e)}this.overflow=this[i].length>this.maxLength,this.overflow&&!this.skipOverflow?r(new Error("maximum buffer reached")):r()}function c(e){if(this[i]+=this[o].end(),this[i])try{h(this,this.mapper(this[i]))}catch(t){return e(t)}e()}function h(e,t){void 0!==t&&e.push(t)}function u(e){return e}e.exports=function(e,t,r){switch(e=e||/\r?\n/,t=t||u,r=r||{},arguments.length){case 1:"function"==typeof e?(t=e,e=/\r?\n/):"object"!=typeof e||e instanceof RegExp||(r=e,e=/\r?\n/);break;case 2:"function"==typeof e?(r=t,t=e,e=/\r?\n/):"object"==typeof t&&(r=t,t=u)}(r=Object.assign({},r)).autoDestroy=!0,r.transform=a,r.flush=c,r.readableObjectMode=!0;const h=new n(r);return h[i]="",h[o]=new s("utf8"),h.matcher=e,h.mapper=t,h.maxLength=r.maxLength,h.skipOverflow=r.skipOverflow||!1,h.overflow=!1,h._destroy=function(e,t){this._writableState.errorEmitted=!1,t(e)},h}},1274:(e,t,r)=>{const n=r(272),s=r(9610).createReadableStream;r=r(2361).EventEmitter;class i extends r{constructor(e,t={}){super(),t={alwaysConnected:!1,recoverAfterApplicationError:!1,...t},this._client=null,this._failover=e,this._connecting=!1,this._closed=!1,this._transmissions=[],this._idle=!1,this._blockIdle=!1,this._alwaysConnected=t.alwaysConnected,this._recoverAfterApplicationError=t.recoverAfterApplicationError,this._alwaysConnected&&this._connect(),this._checkIdle=i.prototype._checkIdle.bind(this)}_connect(){this._connecting||(this._connecting=!0,this._connector=this._failover.connect(((e,t,r)=>{this._connecting=!1,e?this._abort(e):(t.on("error",(e=>{!this._recoverAfterApplicationError&&e.isApplicationError&&e.isApplicationError()?this._abort(e):(this._client=null,this._connecting=!0,r())})),this._client=t,this._retransmit())})))}_disconnect(){var e=0<this._transmissions.length||this._alwaysConnected&&!this._closed;this._connecting&&this._connector&&!e&&this._connector.abort(),null===this._client||e||(this._client.disconnect(),this._client=null)}_retransmit(){if(this._closed)0<this._transmissions.length&&this._abort(new Error("channel is closed")),this._disconnect();else{var e=this._client;if(null===e)this._connect();else for(let t=0;t<this._transmissions.length;t++){const r=this._transmissions[t];r(null,e,this._createCompletionCallback(r))}}}_transmit(e){this._closed?e(new Error("channel is closed")):(this._transmissions.push(e),this._idle=!1,null===this._client?this._connect():e(null,this._client,this._createCompletionCallback(e)))}_createCompletionCallback(e){return this._removeTransmission.bind(this,e)}_checkIdle(){this._blockIdle||0<this._transmissions.length||this._idle||(this._idle=!0,this.emit("idle"),this._disconnect())}_removeTransmission(e){for(let t=0;t<this._transmissions.length;t++)if(this._transmissions[t]===e)return this._transmissions.splice(t,1),void process.nextTick(this._checkIdle)}_abort(e){if(e)for(let t=0;t<this._transmissions.length;t++)this._transmissions[t](e,null,(function(){}));this._transmissions=[]}close(e){this._abort(e),this._closed=!0,this._disconnect()}send(e,t,r){return"function"!=typeof r&&(r=function(){}),this._transmit((function(n,i,o){n?r(n):(n=i.send(e,{onReceipt:function(){o(),r(null)}}),s(t).pipe(n))})),this}_subscribe(e,t){function r(){}let n=r,s=r,i=!1;function o(){i||(i=!0,t=r,s(),n())}const a={cancel:o,unsubscribe:o};return this._transmit((function(r,o,c){if(i)c();else if(r)t(r);else{n=c;const r=e(o,(function(e,r){e||t(null,r,a)}));s=r.unsubscribe.bind(r)}})),a}subscribe(e,t){return this._subscribe((function(t,r){return t.subscribe(e,r)}),t)}setImplicitSubscription(e,t,r){return this._subscribe((function(r,n){return r.setImplicitSubscription(e,t,n)}),r)}ack(){if(null!==this._client)return this._client.ack.apply(this._client,arguments)}nack(){if(null!==this._client)return this._client.nack.apply(this._client,arguments)}begin(e){const t=new n(this);return this._transmit((function(r,n,s){r||(t._completes=[s],t._transaction=n.begin(e))})),t}isEmpty(){return 0===this._transmissions.length}lock(){this._idle=!1,this._blockIdle=!0}unlock(){this._blockIdle=!1,this._checkIdle()}}e.exports=i},1065:(e,t,r)=>{r=r(7694),e.exports=class extends r{constructor(e){super(e,{minChannels:0,minFreeChannels:0,maxChannels:1/0,freeExcessTimeout:null})}}},7694:(e,t,r)=>{const n=r(1274);class s{constructor(e,t={}){var r;if(!(this instanceof s))return r=Object.create(s.prototype),s.apply(r,arguments),r;t={minChannels:1,minFreeChannels:1,maxChannels:1/0,freeExcessTimeout:null,requestChannelTimeout:null,channelOptions:{},...t},this._connectFailover=e,this._minChannels=t.minChannels,this._minFreeChannels=Math.min(t.minFreeChannels,this._minChannels),this._maxChannels=t.maxChannels,this._channels=[],this._channelOptions={...t.channelOptions,alwaysConnected:!0},this._freeChannels=[],this._freeExcessTimeout=t.freeExcessTimeout,this._freeExcessTimeouts=[],this._requestChannelTimeout=t.requestChannelTimeout,this._closed=!1,null!==this._requestChannelTimeout&&(this._channelRequests=[]);for(let e=0;e<this._minChannels;e++)this._allocateFreeChannel()}_createChannel(){return new n(this._connectFailover,this._channelOptions)}_allocateFreeChannel(){var e;if(!(this._channels.length>=this._maxChannels))return e=this._createChannel(),this._channels.push(e),this._freeChannels.push(e),e}_deallocateChannel(e){e.close(),-1!==(e=this._channels.indexOf(e))&&this._channels.splice(e,1)}_addExcessTimeout(){if(!(this._freeChannels.length<=this._minChannels)){const e=()=>{const e=this._freeChannels.shift();e.isEmpty()?this._deallocateChannel(e):this._startIdleListen(e)};null===this._freeExcessTimeout?e():this._freeExcessTimeouts.push(setTimeout((()=>{this._freeExcessTimeouts.shift(),this._freeChannels.length>this._minChannels&&e()}),this._freeExcessTimeout))}}_hasChannelRequestTimeout(){return"number"==typeof this._requestChannelTimeout}_startIdleListen(e){e.once("idle",(()=>{if(this._closed)this._deallocateChannel(e);else if(this._hasChannelRequestTimeout()&&0<this._channelRequests.length){const t=this._channelRequests.shift();clearTimeout(t.timeout),this._startIdleListen(e),t.callback(null,e)}else this._freeChannels.push(e),this._addExcessTimeout()}))}_timeoutChannelRequest(e){this._channelRequests.shift(),e(new Error("failed to allocate channel"))}channel(e){var t;if(this._closed)process.nextTick((function(){e(new Error("channel pool closed"))}));else if(0!==this._freeChannels.length||this._allocateFreeChannel()){const t=this._freeChannels.shift();0<this._freeExcessTimeouts.length&&clearTimeout(this._freeExcessTimeouts.shift()),this._freeChannels.length<this._minFreeChannels&&this._allocateFreeChannel(),this._startIdleListen(t),process.nextTick((function(){e(null,t)}))}else this._hasChannelRequestTimeout()?(t=setTimeout(this._timeoutChannelRequest.bind(this,e),this._requestChannelTimeout),this._channelRequests.push({timeout:t,callback:e})):process.nextTick((function(){e(new Error("failed to allocate channel"))}))}close(){this._closed=!0,this._channels.forEach((function(e){e.close()})),this._channels=[],this._freeChannels=[],this._channelRequests&&(this._channelRequests.forEach((function(e){clearTimeout(e.timeout),e.callback(new Error("channel pool closed"))})),this._channelRequests=[])}}e.exports=s},7078:(e,t,r)=>{const n=r(8831),s=r(2968),i=r(2939),o=r(7538);function a(e){if(-1===["auto","client","client-individual"].indexOf(e))throw new Error("invalid ack mode: '"+e+"'")}function c(e,t){function r(e){"function"==typeof t&&t(e||new Error("The frame failed but no error was provided"))}e.on("error",r),e.end((function(n){e.removeListener("error",r),"function"==typeof t&&t(n)}))}function h(e,t){this.setVersion(e.headers.version||"1.0"),this.setCommandHandlers({MESSAGE:l,RECEIPT:f,ERROR:u}),this.readEmptyBody(e,(()=>{var r;void 0!==e.headers["heart-beat"]&&1<(r=e.headers["heart-beat"].split(",").map((function(e){return parseInt(e,10)}))).length&&!isNaN(r[0])&&!isNaN(r[1])&&this._runHeartbeat(r[0],r[1]),this.headers=e.headers,this.emit("connect",this),t()}))}function u(e){var t=e.headers.message||"server sent ERROR frame";const r=this.createApplicationError(t);if("text/plain"===e.headers["content-type"]&&e.headers["content-length"]<=4096){const t=new o(Buffer.alloc(4096));e.on("end",(function(){r.longMessage=t.getWrittenSlice().toString(),this.destroy(r)})),e.pipe(t)}else this.destroy(r)}function l(e,t){var r=e.headers.subscription;const n=this._subscriptions[r];void 0===n?this.destroy(this.createProtocolError("invalid subscription id "+r)):(n.processMessageFrame(null,e),t())}function f(e,t){const r=e.headers["receipt-id"];void 0===r||void 0===this._receipts[r]?this.destroy(this.createProtocolError("invalid receipt")):this.readEmptyBody(e,(function(){this._receipts[r].call(this),delete this._receipts[r],t()}))}function d(e){this.destroy(this.createProtocolError("unknown command '"+e.command+"'"))}e.exports=class extends n{constructor(e,t={}){super(e,t={commandHandlers:{},unknownCommand:d,resetDisconnect:!0,...t}),this._options=t,this._receipts={},this._nextReceiptId=1,this._subscriptions={},this._nextSubcriptionId=1,this._nextTransactionId=1,this._disconnecting=!1,this._hasDisconnectReceipt=!1,this._resetDisconnect=!0===t.resetDisconnect}_onInputEnd(){var e;this._hasDisconnectReceipt?this.destroy():(e=this.hasFinishedOutput()?"connection ended without disconnect receipt":"connection ended unexpectedly",this.destroy(this.createProtocolError(e)))}_beforeSendResponse(){}_onDestroyed(e){if(e)for(var t in this._subscriptions)this._subscriptions[t].processMessageFrame(e)}sendFrame(e,t,r){if(r){let e=r.onReceipt;if("function"==typeof r.onError){const t=e||function(){},n=r.onError;this.on("error",n),e=()=>{this.removeListener("error",n),t()}}"function"==typeof e&&(r=this._nextReceiptId++,this._receipts[r]=e,t.receipt=r)}return n.prototype.sendFrame.apply(this,arguments)}connect(e,t){"string"==typeof e&&(e={host:e}),e=Object.assign({"accept-version":"1.0,1.1,1.2"},e);let r=this.getHeartbeat();var n;if("string"!=typeof e["heart-beat"]||(n=e["heart-beat"].match(/^(\d+) *, *(\d+)$/))&&(r=[parseInt(n[1],10),parseInt(n[2],10)],this.setHeartbeat(r)),e["heart-beat"]=r[0]+","+r[1],this.setCommandHandlers({CONNECTED:h,ERROR:u}),"function"==typeof t){const s=this;{function i(){s.removeListener("error",a),s.removeListener("connect",o)}const o=function(e){i(),t(null,e)},a=function(e){i(),t(e)};s.on("error",a),s.on("connect",o)}}this.sendFrame("CONNECT",e).end()}send(e,t){return this.sendFrame("SEND",e="string"==typeof e?{destination:e}:e,t)}sendString(e,t,r,n){const s=this.send(e,r);s.write(t),s.end(n)}begin(e){"transaction"in(e="object"!=typeof e?void 0!==e?{transaction:e}:{}:e)||(e.transaction=this._nextTransactionId++);var t=new s(e.transaction,this);return this.sendFrame("BEGIN",e).end(),t}subscribe(e,t){let r=void 0!==(e="string"==typeof e?{destination:e}:e).id?e.id:this._nextSubcriptionId++;for(;void 0!==this._subscriptions[r];)r=this._nextSubcriptionId++;e.id=r;var n=(a(n=e.ack||"auto"),new i(r,n,t,this));return this._subscriptions[r]=n,this.sendFrame("SUBSCRIBE",e).end(),n}_getAckHeaders(e,t){return Object.assign({},t,{subscription:e.headers.subscription,"message-id":e.headers["message-id"],id:e.headers.ack})}ack(e,t,r,n){c(this.sendFrame("ACK",this._getAckHeaders(e,t),r),n)}nack(e,t,r,n){c(this.sendFrame("NACK",this._getAckHeaders(e,t),r),n)}getSubscription(e){return this._subscriptions[e]}setImplicitSubscription(e,t,r){if(this._subscriptions.hasOwnProperty(e))throw new Error("subscription id '"+e+"' already in use");return a(t=null==t?"auto":t),t=new i(e,t,r,this),this._subscriptions[e]=t}disconnect(e){if("function"==typeof e){const t=this;{function r(){t.removeListener("end",n),t.removeListener("error",s)}const n=function(t){r(),e(null,t)},s=function(t){r(),e(t)};t.on("end",n),t.on("error",s)}}this.sendFrame("DISCONNECT",{},{onReceipt:()=>{this._hasDisconnectReceipt=!0;const e=this.getTransportSocket();this._resetDisconnect?this.destroy():e.end()}}).end(this._finishOutput.bind(this)),this._disconnecting=!0}readEmptyBody(e,t){e.readEmptyBody((e=>{e?"function"==typeof t&&t.call(this):this.destroy(this.createProtocolError("expected empty body frame"))}))}getOptions(){return this._options}}},3121:(e,t,r)=>{var n=r(2361).EventEmitter;const s=r(3837).format,i=r(1945),o=r(8540),a=r(6468),c=r(1026);e.exports=class extends n{constructor(e,t){super();var r,n={initialReconnectDelay:10,maxReconnectDelay:3e4,useExponentialBackOff:!0,reconnectDelayExponent:2,maxReconnects:-1,randomize:!0,connectFunction:i};switch(t={...n,...t},typeof e){case"undefined":e=[{}];break;case"string":var s=a(e);e=s.servers,Object.assign(t,s.options)}for(r in n)this[r]=t[r];this._defaultConnectOptions="object"==typeof t.connect?t.connect:{},this._connect=t.connectFunction,this._servers=e.map(this._createServer.bind(this))}_createServer(e){return{connectOptions:e=this._normalizeConnectOptions(e),remoteAddress:o(e)}}_normalizeConnectOptions(e){var t=Object.assign({host:"localhost",port:61613},this._defaultConnectOptions);switch(typeof e){case"string":var r=c(e);r.connectHeaders&&t.connectHeaders&&Object.assign(r.connectHeaders,t.connectHeaders,r.connectHeaders),Object.assign(t,r);break;case"object":Object.assign(t,e);break;default:throw new Error(`invalid type (${typeof e}) for server config argument`)}return t}addServer(){this._servers.push(this._createServer.apply(this,arguments))}getReconnectDelay(e){return Math.min(this.initialReconnectDelay*(this.useExponentialBackOff?Math.pow(this.reconnectDelayExponent,e)-1:Math.min(e,1)),this.maxReconnectDelay)}_initConnectState(){function e(e){this.serverProperties=e,this.failedConnects=0,this._blacklisted=!1,this._blacklistError=null}e.prototype.blacklist=function(e){this._blacklisted||(this._blacklisted=!0,this._blacklistError=e)},e.prototype.isBlacklisted=function(){return this._blacklisted},e.prototype.getBlacklistError=function(){return this._blacklistError};const t=this._servers.map((function(t){return new e(t)}));if(!0===this.randomize&&2<t.length)for(let e=1;e<t.length;e++){var r=t[e],n=1+Math.round(Math.random()*(t.length-2));t[e]=t[n],t[n]=r}return t}connect(e){const t=this._initConnectState(),r=[];if(0!==t.length){const n=this,i=this._connect;let o;const a=this.maxReconnects;let c,h=!1;return u(),{abort:function(){h=!0,clearTimeout(c),o&&o.getTransportSocket().destroy()}};function u(){if(!h){const r=t[0];o=i(r.serverProperties.connectOptions,(function(t,s){o=null,h?t||s.destroy():t?(0<n.listeners("error").length&&(t.connectArgs=r.serverProperties.connectOptions,n.emit("error",t,r)),"function"==typeof t.isApplicationError&&t.isApplicationError()&&r.blacklist(t),r.failedConnects+=1,l()):(r.failedConnects=0,n.emit("connect",r),e(null,s,l,r))})),n.emit("connecting",r)}}function l(){if(!h){const o=t[0];var i;-1!==a&&o.failedConnects>=a&&o.blacklist(new Error(s("too many failed connects (%d)",o.failedConnects))),t.shift(),(o.isBlacklisted()?r:t).push(o),0===t.length?(i=1==r.length?r[0].getBlacklistError():new Error("exhausted connection failover"),e(i)):c=setTimeout(u,n.getReconnectDelay(t[0].failedConnects))}}}e(new Error("no server addresses"))}}},7035:(e,t,r)=>{var{Readable:n,Transform:s}=r(2781);const i=r(1576).StringDecoder,o="\r".charCodeAt(0),a="\n".charCodeAt(0);class c extends Error{constructor(e){super(e)}}class h extends s{constructor(e={}){e.objectMode=!0,e.highWaterMark=1,super(e),this._parse=h.prototype._parseCommandLine,this._parsingFrame=!1,this._chunk=null,this._paused=!1,this._transformCallback=null,this._currentLine="",this._maxLineLength=e.maxLineLength||1024,this._lineStringEncoding="utf-8",this._command="",this._headers={},this._numHeaders=0,this._maxHeaders=e.maxHeaders||64,this._frameStreamOptions=e.frameStreamOptions||{},this._frame=null,this.setVersion("1.0")}setVersion(e){return void 0!==(e={"1.0":function(e){return e},1.1:l({"\\n":"\n","\\c":":","\\\\":"\\"}),1.2:l({"\\r":"\r","\\n":"\n","\\c":":","\\\\":"\\"})}[e])&&(this._decode=e,!0)}_transform(e,t,r){"string"==typeof e&&(e=Buffer.from(e,t)),this._chunk=e,this._transformCallback=r,this._continueTransform()}_continueTransform(){for(this._paused=!1;!this._paused&&0<this._chunk.length;)try{this._parse()}catch(e){if(e instanceof c)return void this._transformCallback(e);throw e}if(0===this._chunk.length&&this._transformCallback&&!this._paused){const e=this._transformCallback;this._transformCallback=null,e()}}_flush(e){this._parsingFrame?e(new c("unexpected end of stream")):this._shouldDeferPush()?setImmediate((()=>{this.push(null),e()})):(this.push(null),e())}_consume(e){this._chunk=this._chunk.slice(e)}_exceededLineLengthLimit(){var e="maximum line length exceeded ("+this._maxLineLength+" byte limit)";throw new c(e)}_pause(){return this._paused=!0,this._continueTransform.bind(this)}_parseLine(){const e=this._chunk;var t=e.length,r=this._currentLine.length,n=this._maxLineLength-r;for(let r=0;r<t;r++)if(e[r]===a){r+1>n&&this._exceededLineLengthLimit();let t=r;0<r&&e[r-1]===o&&--t;var s=this._currentLine+e.toString(this._lineStringEncoding,0,t);return this._currentLine="",this._consume(r+1),s}return n<t&&this._exceededLineLengthLimit(),this._currentLine+=e.toString(this._lineStringEncoding),this._consume(e.length),null}_parseCommandLine(){this._parsingFrame=!0;var e=this._parseLine();null!==e&&(this._command=this._decode(e),this._headers={},this._numHeaders=0,this._parse=h.prototype._parseHeaderLine)}_parseHeaderLine(){const e=this._parseLine();if(null!==e){if(0===e.length)return this._beginBody();if(-1===(r=e.indexOf(":")))throw new c("header parse error");var t=this._decode(e.substring(0,r)),r=this._decode(e.substring(r+1));if(!this._headers.hasOwnProperty(t)){if(this._numHeaders==this._maxHeaders)throw new c("too many headers");this._headers[t]=r,this._numHeaders+=1}}}_beginBody(){if(void 0!==this._headers["content-length"]){var e=parseInt(this._headers["content-length"],10);if(isNaN(e))throw new c("invalid content-length");this._headers["content-length"]=e,this._contentLengthRemaining=e,this._parse=h.prototype._parseFixedLengthBody}else this._parse=h.prototype._parseBody;this._frame=new u(this._command,this._headers,{highWaterMark:0}),this._shouldDeferPush()?setImmediate(this.push.bind(this,this._frame)):this.push(this._frame)}_shouldDeferPush(){return process.hasOwnProperty("_tickInfoBox")}_parseFixedLengthBody(){var e=this._contentLengthRemaining;const t=this._chunk;e=Math.min(t.length,e),this._frame.push(t.slice(0,e))||(this._frame._resume=this._pause()),this._consume(e),this._contentLengthRemaining-=e,0===this._contentLengthRemaining&&(this._parse=h.prototype._parseNullByte)}_parseBody(){const e=this._chunk;var t=e.length;let r=t,n=!1;for(let s=0;s<t;s++)if(0===e[s]){r=s,n=!0;break}this._frame.push(e.slice(0,r))||(this._frame._resume=this._pause()),this._consume(r),n&&(this._consume(1),this._beginTrailer())}_parseNullByte(){if(0!==this._chunk[0])throw new c("expected null byte");this._consume(1),this._beginTrailer()}_beginTrailer(){if(this._parsingFrame=!1,this._parse=h.prototype._parseTrailer,this._frame._resume){const e=this._frame,t=this._frame._resume;this._frame._resume=function(){e.push(null),t()}}else this._frame.push(null)}_parseTrailer(){var e=this._chunk;let t=0;var r=e.length;for(let n=0;n<r;n++)if(e[n]===o){if(0!==this._currentLine.length)throw new c("invalid EOL sequence in trailer");this._currentLine="\r",t+=1}else{if(e[n]!==a){if(0<this._currentLine.length)throw new c("invalid EOL sequence in trailer");this._parse=h.prototype._parseCommandLine;break}this._currentLine="",t+=1}this._consume(t)}}class u extends n{constructor(e,t,r){super(r),this.command=e,this.headers=t}_read(){if(this._resume){const e=this._resume;delete this._resume,e()}}readEmptyBody(e){e=e||function(){};const t=()=>{null!==this.read()&&(e(!1),e=function(){})};this.once("end",(()=>{this.removeListener("readable",t),e(!0)})),this.on("readable",t),this.read(0)}readString(e,t){const r=this,n=new i(e);let s="";const o=function(){var e=r.read();null!==e&&(s+=n.write(e),o())};r.on("readable",o),r.on("end",(function(){s+=n.end(),t(null,s)})),r.on("error",t),o()}}function l(e){return function(t){return t.replace(/\\./gi,(function(t){if(e.hasOwnProperty(t))return e[t];throw new c("undefined escape sequence")}))}}e.exports=h},5547:(e,t,r)=>{const n=r(2781).Writable;class s extends n{constructor(e,t,r,n){super(n),this._stream=e,this._writes=[],this._write=this._writeHeaderAndBody,this.command=t,this.headers=r||{}}end(e,t,r){"function"==typeof e?(r=e,t=e=null):"function"==typeof t&&(r=t,t=null),null!=e?this.write(e,t,(e=>{e&&r?r(e):this._endFrame(r)})):this._endFrame(r)}_endFrame(e){this.write("\0\n","utf-8",(t=>{e&&e(t),o(this._stream),n.prototype.end.apply(this)}))}_writeHeaderAndBody(e,t,r){this._writeHeader(),this._writeBody(e,t,r)}_writeHeader(e){let t=this._stream._encode(this.command)+"\n";for(var r in this.headers){var n=this.headers[r];null!=n&&(t+=this._stream._encode(r)+":"+this._stream._encode(n)+"\n")}t+="\n",this._pushWriteRequest(t,"utf-8",e),this._write=this._writeBody}_writeBody(e,t,r){this._pushWriteRequest(e,t,r),i(this._stream)}_pushWriteRequest(e,t,r){this._writes.push({chunk:e,encoding:t,cb:r||function(){}})}}function i(e){if(!(e._writing||null===e._frame||e._frame._writes.length<1))if(e._destinationFinished)t=new Error("cannot send frame on closed stream"),e._frame.emit("error",t),o(e);else{const n=e._frame,s=n._writes.shift();var t=s.chunk,r=s.encoding;e._destination.write(t,r,(function(t){e._writing=!1,t&&n.emit&&n.emit("error",t),s.cb(t),(t?o:i)(e)}))||(e._writing=!0)}}function o(e){e._frame&&(e._frame._write=c),0<e._queue.length?e._frame=e._queue.shift():e._frame=null,i(e)}function a(e){return function(t){t=""+t;for(let r=0;r<e.length;r++)t=t.replace(e[r][0],e[r][1]);return t}}function c(e,t,r){r(new Error("cannot write on closed stream"))}e.exports=class{constructor(e){this._destination=e,this._destinationFinished=!1,this._writing=!1;var t=this.finish.bind(this);e.on("error",t),e.on("close",t),e.on("finish",t),e.on("drain",i.bind(null,this)),this._frame=null,this._queue=[],this.setVersion("1.0")}setVersion(e){return void 0!==(e={"1.0":a([]),1.1:a([[/\\/g,"\\\\"],[/\n/g,"\\n"],[/:/g,"\\c"]]),1.2:a([[/\\/g,"\\\\"],[/\r/g,"\\r"],[/\n/g,"\\n"],[/:/g,"\\c"]])}[e])&&(this._encode=e,!0)}_queueFrame(e){return null===this._frame?this._frame=e:this._queue.push(e),e}frame(e,t,r){return this._queueFrame(new s(this,e,t,r))}heartbeat(){this._frame||this._destination.write("\n","utf8")}finish(){this._destinationFinished=!0}hasFinished(){return this._destinationFinished}}},8831:(e,t,r)=>{const n=r(5547),s=r(7035);r=r(2361).EventEmitter,e.exports=class extends r{constructor(e,t){super(),this._commandHandlers=t.commandHandlers,this._unknownCommandHandler=t.unknownCommand||function(){this.destroy()},this._destroyed=!1,this._destroy=this.destroy.bind(this),this._transportSocket=e,this._transportFinished=!1,e.on("finish",(()=>{this._transportFinished=!0})),e.on("error",(e=>{"ECONNRESET"===(e.code||e.errno)&&this.hasFinishedOutput()?this._onInputEnd():this.destroy(this.createTransportError(e))}));const r=new s(t),i=(this._incoming=r,e.pipe(r),this._readingFrame=!1,this._output=t.outgoingFrameStream||new n(e),this._heartbeat=t.heartbeat||[0,0],this._heartbeatDelayMargin=t.heartbeatDelayMargin||100,this._heartbeatOutputMargin=t.heartbeatOutputMargin||0,(e,t)=>{e.on("end",t);const r=this._commandHandlers[e.command];t=(t,r)=>this._beforeSendResponse(e,t,r||function(){}),("function"==typeof r?r:this._unknownCommandHandler).apply(this,[e,t])}),o=()=>{var e;this._readingFrame||(e=r.read())&&(this._readingFrame=!0,i(e,(e=>{this._readingFrame=!1,e||process.nextTick(o)})))};r.on("readable",o),r.on("error",(e=>{this.destroy(this.createProtocolError(e))})),r.on("end",(()=>{this._onInputEnd()})),o()}_onInputEnd(){this.destroy()}destroy(e){this._destroyed||(this._destroyed=!0,this._transportSocket.destroy(e),e?this.emit("error",e):this.emit("end"),"function"==typeof this._onDestroyed&&this._onDestroyed(e))}_finishOutput(){this.hasFinishedOutput()||(this._output.finish(),this.emit("finish"))}hasFinishedOutput(){return this._output.hasFinished()}setVersion(e){this._incoming.setVersion(e),this._output.setVersion(e)}getTransportSocket(){return this._transportSocket}setCommandHandler(e,t){this._commandHandlers[e]=t}setCommandHandlers(e){this._commandHandlers=e}setUnknownCommandHandler(e){this._unknownCommandHandler=e}sendFrame(e,t,r){const n=this._output.frame(e,t,r);return n.on("error",this._destroy),n}getHeartbeat(){return this._heartbeat}setHeartbeat(e){this._heartbeat=e}_runHeartbeat(e,t){t=0===t||0===this._heartbeat[0]?0:Math.max(t,this._heartbeat[0])-this._heartbeatOutputMargin,e=0===e||0===this._heartbeat[1]?0:Math.max(e,this._heartbeat[1])+this._heartbeatDelayMargin;const r=this,n=[];function s(){for(let e=0;e<n.length;e++)clearInterval(n[e])}const i=this._transportSocket;if(i.once("error",s),i.once("end",s),i.once("close",s),0<t&&(this._transportSocket.setNoDelay&&this._transportSocket.setNoDelay(!0),n.push(setInterval((function(){r._output.heartbeat()}),t))),0<e){let t=0;n.push(setInterval((function(){var e=r._transportSocket.bytesRead;e-t==0&&r.destroy(r.createTransportError("connection timed out")),t=e}),e))}}_createError(e,t){return e instanceof Error||(e=new Error(e)),Object.assign(e,Object.assign({isTransportError:()=>!1,isProtocolError:()=>!1,isApplicationError:()=>!1},t)),e}createTransportError(e){return this._createError(e,{isTransportError:()=>!0})}createProtocolError(e){return this._createError(e,{isProtocolError:()=>!0})}createApplicationError(e){return this._createError(e,{isApplicationError:()=>!0})}}},272:(e,t,r)=>{const n=r(9610).createReadableStream;e.exports=class{constructor(e){this._channel=e,this._completes=[],this._transaction=null}send(e,t){return this._channel._transmit(((r,s,i)=>{r||(this._completes.push(i),r=this._transaction.send(e),n(t).pipe(r))})),this}abort(){this._channel._transmit(((e,t,r)=>{e||(this._transaction.abort(),this._completes.push(r),this._completed())}))}commit(e){this._channel._transmit(((t,r,n)=>{t?e(t):(this._completes.push(n),this._transaction.commit({onReceipt:()=>{e(null),this._completed()}}))}))}_completed(){for(let e=0;e<this._completes.length;e++)this._completes[e]();this._completes=[]}}},2939:(e,t,r)=>{const n=r(8124);e.exports=class{constructor(e,t,r,n){this._id=e,this._ack=t,this._onMessageCallback=r,this._client=n,this._unsubscribing=!1}getId(){return this._id}_createMessageObject(e){if(e)return e}processMessageFrame(e,t){this._unsubscribing||this._client._disconnecting&&"auto"!==this._ack?t&&t.pipe(new n):this._onMessageCallback.call(this,e,this._createMessageObject(t),this)}unsubscribe(e){this._unsubscribing||(this._unsubscribing=!0,e=Object.assign({},e,{id:this._id}),this._client.sendFrame("UNSUBSCRIBE",e,{onReceipt:()=>{delete this._client._subscriptions[this._id]}}).end())}}},2968:e=>{e.exports=class{constructor(e,t){this._client=t,this.id=e}send(){const e=this._client.send.apply(this._client,arguments);return e.headers.transaction=this.id,e}abort(e){this._client.sendFrame("ABORT",{transaction:this.id},e).end()}commit(e){this._client.sendFrame("COMMIT",{transaction:this.id},e).end()}}},8540:e=>{e.exports=function(e){let t;"function"==typeof e.connect&&"function"==typeof e.connect.getAddressInfo&&(t=e.connect.getAddressInfo(e));var r="string"==typeof e.path,n="string"==typeof e.host,s=!isNaN(e.port),i=!0===e.ssl,o=(a="object"==typeof e.connectHeaders)&&e.connectHeaders.login,a=a&&"string"==typeof e.connectHeaders.host&&0<e.connectHeaders.host.length;let c,h=(n?c=i?"ssl":"tcp":r&&(c="unix"),"stomp+"+c+"://"),u=(o&&(h+=o+"@"),"");return n?u+=e.host:r&&(u+=e.path),n&&s&&(u+=":"+e.port),h+=u,a&&(h+="/"+e.connectHeaders.host),Object.assign({connectArgs:e,transport:c,transportPath:u,path:e.path,host:e.host,port:e.port,pseudoUri:h},t||{})}},6468:(e,t,r)=>{const n=r(5746).parse,{existsSync:s,readFileSync:i}=r(7147),o=function(e){var t=(e=""+e).toLowerCase();return"false"===t?e=!1:"true"===t?e=!0:null!==e.match(/^-?[0-9]+(\.[0-9]+)?$/)&&(t=parseFloat(e,10),isNaN(t)||(e=t)),e},a=function(e){const t={};for(const n in e){let s=e[n];var r=typeof s;s=("object"==r||"array"==r?a:o)(s),t[n]=s}return t};function c(e){this.options=e}c.prototype.boolProperty=function(e){let t=this.options[e];if(void 0!==t){var r=typeof t;if("boolean"!=typeof(t="number"==r?Boolean(t):t))throw r="invalid "+e+" value '"+this.options[e]+"' (expected boolean)",new Error(r);this.options[e]=t}},c.prototype.floatProperty=function(e,t,r){var n=this.options[e];if(void 0!==n){if("number"!=typeof n||n<t||r<n)throw t="invalid "+e+" value '"+this.options[e]+"' (expected number between "+t+" and "+r+")",new Error(t);this.options[e]=n}},c.prototype.fileProperty=function(e){var t=this.options[e];if(void 0!==t){if(!s(t))throw new Error("invalid "+e+" file not found '"+t+"'");this.options[e]=i(t)}},e.exports=function(e){let t=e,r=null;const s=e.match(/^failover:\(([^\)]*)\)(\?.*)?$/);s&&(t=s[1],r=s[2]?s[2].substring(1):void 0),e=0<t.length?t.split(","):[];var i=r?a(n(r)):{};const o=new c(i);if(o.floatProperty("initialReconnectDelay",0,1/0),o.floatProperty("maxReconnectDelay",0,1/0),o.floatProperty("reconnectDelayExponent",0,1/0),o.floatProperty("maxReconnects",-1,1/0),o.boolProperty("useExponentialBackOff"),o.boolProperty("randomize"),"object"==typeof i.connect){const e=new c(i.connect);e.boolProperty("ssl"),e.fileProperty("pfx"),e.fileProperty("key"),e.fileProperty("cert"),e.fileProperty("ca")}return{servers:e,options:i}}},1026:e=>{e.exports=function(e){if(!(i=e.match(/^\s*((\w+):\/\/)?(([^:]+):([^@]+)@)?([\w-.]+)(:(\d+))?\s*$/)))throw new Error("could not parse server uri '"+e+"'");var t=i[2],r=i[4],n=i[5],s=i[6],i=i[8];const o={host:s,connectHeaders:{}};if(void 0!==t&&(o.ssl="ssl"===t||"stomp+ssl"===t),void 0!==i&&(o.port=parseInt(i,10)),void 0!==r&&(o.connectHeaders.login=r),void 0!==n&&(o.connectHeaders.passcode=n),"unix"===t||"/"===s[0]){if(void 0!==i)throw new Error("invalid server uri '"+e+"'");o.path=s,o.ssl=!1}return o}},1945:(e,t,r)=>{const n=r(1808),s=r(4404),i=r(7078);function o(){var e=a(arguments);const t={host:"localhost",port:61613,timeout:3e3,connectHeaders:{},...e[0]},r=e[1];let o=null,c=null,h=null,u=null;function l(){h&&clearTimeout(h),o.removeListener("error",f),o.removeListener("connect",d)}const f=function(e){l(),e.connectArgs=t,"function"==typeof r&&r(e)},d=function(){u&&(c.destroy=u),l(),o.emit("socket-connect");var e=Object.assign({host:t.host},t.connectHeaders);o.connect(e,r)};let p=n.connect;if("connect"in t)p=t.connect;else if("ssl"in t)if("boolean"==typeof t.ssl)!0===t.ssl&&(p=s.connect);else if(void 0!==t.ssl)throw new Error("expected ssl property to have boolean value");return c=p(t,d),0<t.timeout&&(h=setTimeout((function(){o.destroy(o.createTransportError("connect timed out"))}),t.timeout),u=c.destroy,c.destroy=function(){clearTimeout(h),(c.destroy=u).apply(c,arguments)}),(o=new i(c,t)).on("error",f),o}function a(e){if(0===e.length)throw new Error("no connect arguments");let t,r={},n=1;if("object"==typeof e[0])r=e[0];else if(function(e){return("number"==(r=typeof(t=e))&&0<=t&&Math.round(t)===t||"string"==r&&null!==t.match(/\d+/))&&0<=e&&e<=65535;var t,r}(e[0]))r.port=parseInt(e[0],10),1<e.length&&"string"==typeof e[1]?(r.host=e[1],n=2):r.host="localhost";else{if("string"!=typeof e[0])throw new Error("invalid connect argument (expected port or path value)");r.path=e[0]}if(n<e.length){if("function"!=typeof e[n])throw new Error("invalid connect argument (expected connectListener argument to be a function)");if(t=e[n],e.length>n+1)throw new Error("too many arguments")}return[r,t]}o.normalizeConnectArgs=a,e.exports=o},4572:(e,t,r)=>{e.exports={IncomingFrameStream:r(7035),OutgoingFrameStream:r(5547),Client:r(7078),connect:r(1945),ConnectFailover:r(3121),Channel:r(1274),ChannelFactory:r(1065),ChannelPool:r(7694)}},9610:(e,t,r)=>{const n=r(2781).Readable,s=r(1205);e.exports={createReadableStream:function(e){var t;return(e="function"==typeof e?e():e)instanceof n||((t=e)instanceof Buffer||(t=Buffer.from(e)),e=new s(t)),e}}},8124:(e,t,r)=>{var n=r(2781).Writable;const s=r(6113).createHash;e.exports=class extends n{constructor(e){super(),this.bytesWritten=0,this._hash=s(e||"md5")}_write(e,t,r){this.bytesWritten+=e.length,this._hash.update(e),r()}getBytesWritten(){return this.bytesWritten}getHashDigest(e){return this._hash.digest(e)}}},1205:(e,t,r)=>{r=r(2781).Readable,e.exports=class extends r{constructor(e,t){super(t),this._buffer=e,this._offset=0}_read(e){0===(e=Math.min(e,this._buffer.length-this._offset))?this.push(null):(this.push(this._buffer.slice(this._offset,this._offset+e)),this._offset+=e)}getBytesRead(){return this._offset}getBuffer(){return this._buffer}}},7538:(e,t,r)=>{r=r(2781).Writable,e.exports=class extends r{constructor(e,t={}){t.decodeStrings=!0,super(t),this._buffer=e,this._written=0}_write(e,t,r){e.length>this._buffer.length-this._written?r(new Error("would truncate chunk")):(e.copy(this._buffer,this._written,0,e.length),this._written+=e.length,process.nextTick(r))}getBuffer(){return this._buffer}getBytesWritten(){return this._written}getWrittenSlice(){return this._buffer.slice(0,this._written)}}},7755:e=>{"use strict";var t=String.prototype.replace,r=/%20/g,n="RFC3986";e.exports={default:n,formatters:{RFC1738:function(e){return t.call(e,r,"+")},RFC3986:function(e){return String(e)}},RFC1738:"RFC1738",RFC3986:n}},5746:(e,t,r)=>{"use strict";var n=r(9110),s=r(72);r=r(7755),e.exports={formats:r,parse:s,stringify:n}},72:(e,t,r)=>{"use strict";function n(e,t,r,n){if(e){var s=r.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/g,a=0<r.depth&&/(\[[^[\]]*])/.exec(s),h=[];if(e=a?s.slice(0,a.index):s){if(!r.plainObjects&&i.call(Object.prototype,e)&&!r.allowPrototypes)return;h.push(e)}for(var u=0;0<r.depth&&null!==(a=o.exec(s))&&u<r.depth;){if(u+=1,!r.plainObjects&&i.call(Object.prototype,a[1].slice(1,-1))&&!r.allowPrototypes)return;h.push(a[1])}a&&h.push("["+s.slice(a.index)+"]");for(var l=h,f=(e=t,r),d=n?e:c(e,f),p=l.length-1;0<=p;--p){var m,g,y,b=l[p];"[]"===b&&f.parseArrays?m=[].concat(d):(m=f.plainObjects?Object.create(null):{},g="["===b.charAt(0)&&"]"===b.charAt(b.length-1)?b.slice(1,-1):b,y=parseInt(g,10),f.parseArrays||""!==g?!isNaN(y)&&b!==g&&String(y)===g&&0<=y&&f.parseArrays&&y<=f.arrayLimit?(m=[])[y]=d:"__proto__"!==g&&(m[g]=d):m={0:d}),d=m}return d}}var s=r(4783),i=Object.prototype.hasOwnProperty,o=Array.isArray,a={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:s.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},c=function(e,t){return e&&"string"==typeof e&&t.comma&&-1<e.indexOf(",")?e.split(","):e};e.exports=function(e,t){var r=function(e){if(!e)return a;if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=(void 0===e.charset?a:e).charset;return{allowDots:void 0===e.allowDots?a.allowDots:!!e.allowDots,allowPrototypes:("boolean"==typeof e.allowPrototypes?e:a).allowPrototypes,arrayLimit:("number"==typeof e.arrayLimit?e:a).arrayLimit,charset:t,charsetSentinel:("boolean"==typeof e.charsetSentinel?e:a).charsetSentinel,comma:("boolean"==typeof e.comma?e:a).comma,decoder:("function"==typeof e.decoder?e:a).decoder,delimiter:("string"==typeof e.delimiter||s.isRegExp(e.delimiter)?e:a).delimiter,depth:"number"==typeof e.depth||!1===e.depth?+e.depth:a.depth,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:("boolean"==typeof e.interpretNumericEntities?e:a).interpretNumericEntities,parameterLimit:("number"==typeof e.parameterLimit?e:a).parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:("boolean"==typeof e.plainObjects?e:a).plainObjects,strictNullHandling:("boolean"==typeof e.strictNullHandling?e:a).strictNullHandling}}(t);if(""===e||null==e)return r.plainObjects?Object.create(null):{};for(var h="string"==typeof e?function(e,t){var r,n,h,u,l={},f=(e=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,t.parameterLimit===1/0?void 0:t.parameterLimit),d=e.split(t.delimiter,f),p=-1,m=t.charset;if(t.charsetSentinel)for(r=0;r<d.length;++r)0===d[r].indexOf("utf8=")&&("utf8=%E2%9C%93"===d[r]?m="utf-8":"utf8=%26%2310003%3B"===d[r]&&(m="iso-8859-1"),p=r,r=d.length);for(r=0;r<d.length;++r)r!==p&&((u=-1===(u=-1===(u=(n=d[r]).indexOf("]="))?n.indexOf("="):u+1)?(h=t.decoder(n,a.decoder,m,"key"),t.strictNullHandling?null:""):(h=t.decoder(n.slice(0,u),a.decoder,m,"key"),s.maybeMap(c(n.slice(u+1),t),(function(e){return t.decoder(e,a.decoder,m,"value")}))))&&t.interpretNumericEntities&&"iso-8859-1"===m&&(u=u.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))),-1<n.indexOf("[]=")&&(u=o(u)?[u]:u),i.call(l,h)?l[h]=s.combine(l[h],u):l[h]=u);return l}(e,r):e,u=r.plainObjects?Object.create(null):{},l=Object.keys(h),f=0;f<l.length;++f){var d=n(d=l[f],h[d],r,"string"==typeof e);u=s.merge(u,d,r)}return s.compact(u)}},9110:(e,t,r)=>{"use strict";function n(e,t){l.apply(e,h(t)?t:[t])}function s(e,t,r,o,a,c,l,f,p,m,g,y,b,_){var v=e;if("function"==typeof l?v=l(t,v):v instanceof Date?v=m(v):"comma"===r&&h(v)&&(v=i.maybeMap(v,(function(e){return e instanceof Date?m(e):e}))),null===v){if(o)return c&&!b?c(t,d.encoder,_,"key",g):t;v=""}if("string"==typeof(e=v)||"number"==typeof e||"boolean"==typeof e||"symbol"==typeof e||"bigint"==typeof e||i.isBuffer(v)){if(c){if(e=b?t:c(t,d.encoder,_,"key",g),"comma"===r&&b){for(var w=u.call(String(v),","),E="",S=0;S<w.length;++S)E+=(0===S?"":",")+y(c(w[S],d.encoder,_,"value",g));return[y(e)+"="+E]}return[y(e)+"="+y(c(v,d.encoder,_,"value",g))]}return[y(t)+"="+y(String(v))]}var x,C=[];if(void 0!==v){x="comma"===r&&h(v)?[{value:0<v.length?v.join(",")||null:void 0}]:h(l)?l:(e=Object.keys(v),f?e.sort(f):e);for(var k=0;k<x.length;++k){var P=x[k],O="object"==typeof P&&void 0!==P.value?P.value:v[P];a&&null===O||n(C,s(O,P=h(v)?"function"==typeof r?r(t,P):t:t+(p?"."+P:"["+P+"]"),r,o,a,c,l,f,p,m,g,y,b,_))}}return C}var i=r(4783),o=r(7755),a=Object.prototype.hasOwnProperty,c={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},h=Array.isArray,u=String.prototype.split,l=Array.prototype.push,f=Date.prototype.toISOString,d=(r=o.default,{addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:i.encode,encodeValuesOnly:!1,format:r,formatter:o.formatters[r],indices:!1,serializeDate:function(e){return f.call(e)},skipNulls:!1,strictNullHandling:!1});e.exports=function(e,t){var r=e,i=function(e){if(!e)return d;if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||d.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=o.default;if(void 0!==e.format){if(!a.call(o.formatters,e.format))throw new TypeError("Unknown format option provided.");r=e.format}var n=o.formatters[r],s=d.filter;return"function"!=typeof e.filter&&!h(e.filter)||(s=e.filter),{addQueryPrefix:("boolean"==typeof e.addQueryPrefix?e:d).addQueryPrefix,allowDots:void 0===e.allowDots?d.allowDots:!!e.allowDots,charset:t,charsetSentinel:("boolean"==typeof e.charsetSentinel?e:d).charsetSentinel,delimiter:(void 0===e.delimiter?d:e).delimiter,encode:("boolean"==typeof e.encode?e:d).encode,encoder:("function"==typeof e.encoder?e:d).encoder,encodeValuesOnly:("boolean"==typeof e.encodeValuesOnly?e:d).encodeValuesOnly,filter:s,format:r,formatter:n,serializeDate:("function"==typeof e.serializeDate?e:d).serializeDate,skipNulls:("boolean"==typeof e.skipNulls?e:d).skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:("boolean"==typeof e.strictNullHandling?e:d).strictNullHandling}}(t),u=("function"==typeof i.filter?r=(0,i.filter)("",r):h(i.filter)&&(f=i.filter),[]);if("object"!=typeof r||null===r)return"";e=t&&t.arrayFormat in c?t.arrayFormat:t&&"indices"in t&&!t.indices?"repeat":"indices";var l=c[e],f=f||Object.keys(r);i.sort&&f.sort(i.sort);for(var p=0;p<f.length;++p){var m=f[p];i.skipNulls&&null===r[m]||n(u,s(r[m],m,l,i.strictNullHandling,i.skipNulls,i.encode?i.encoder:null,i.filter,i.sort,i.allowDots,i.serializeDate,i.format,i.formatter,i.encodeValuesOnly,i.charset))}return t=u.join(i.delimiter),e=!0===i.addQueryPrefix?"?":"",i.charsetSentinel&&("iso-8859-1"===i.charset?e+="utf8=%26%2310003%3B&":e+="utf8=%E2%9C%93&"),0<t.length?e+t:""}},4783:(e,t,r)=>{"use strict";function n(e,t){for(var r=t&&t.plainObjects?Object.create(null):{},n=0;n<e.length;++n)void 0!==e[n]&&(r[n]=e[n]);return r}var s=r(7755),i=Object.prototype.hasOwnProperty,o=Array.isArray,a=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}();e.exports={arrayToObject:n,assign:function(e,t){return Object.keys(t).reduce((function(e,r){return e[r]=t[r],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],n=0;n<t.length;++n)for(var s=t[n],i=s.obj[s.prop],a=Object.keys(i),c=0;c<a.length;++c){var h=a[c],u=i[h];"object"==typeof u&&null!==u&&-1===r.indexOf(u)&&(t.push({obj:i,prop:h}),r.push(u))}for(var l=t;1<l.length;){var f=l.pop(),d=f.obj[f.prop];if(o(d)){for(var p=[],m=0;m<d.length;++m)void 0!==d[m]&&p.push(d[m]);f.obj[f.prop]=p}}return e},decode:function(e,t,r){if(e=e.replace(/\+/g," "),"iso-8859-1"===r)return e.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(e)}catch(t){return e}},encode:function(e,t,r,n,i){if(0===e.length)return e;var o=e;if("symbol"==typeof e?o=Symbol.prototype.toString.call(e):"string"!=typeof e&&(o=String(e)),"iso-8859-1"===r)return escape(o).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var c="",h=0;h<o.length;++h){var u=o.charCodeAt(h);45===u||46===u||95===u||126===u||48<=u&&u<=57||65<=u&&u<=90||97<=u&&u<=122||i===s.RFC1738&&(40===u||41===u)?c+=o.charAt(h):u<128?c+=a[u]:u<2048?c+=a[192|u>>6]+a[128|63&u]:u<55296||57344<=u?c+=a[224|u>>12]+a[128|u>>6&63]+a[128|63&u]:(h+=1,u=65536+((1023&u)<<10|1023&o.charCodeAt(h)),c+=a[240|u>>18]+a[128|u>>12&63]+a[128|u>>6&63]+a[128|63&u])}return c},isBuffer:function(e){return!(!e||"object"!=typeof e||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},maybeMap:function(e,t){if(o(e)){for(var r=[],n=0;n<e.length;n+=1)r.push(t(e[n]));return r}return t(e)},merge:function e(t,r,s){if(!r)return t;if("object"!=typeof r){if(o(t))t.push(r);else{if(!t||"object"!=typeof t)return[t,r];(s&&(s.plainObjects||s.allowPrototypes)||!i.call(Object.prototype,r))&&(t[r]=!0)}return t}if(!t||"object"!=typeof t)return[t].concat(r);var a=t;return o(t)&&!o(r)&&(a=n(t,s)),o(t)&&o(r)?(r.forEach((function(r,n){var o;i.call(t,n)?(o=t[n])&&"object"==typeof o&&r&&"object"==typeof r?t[n]=e(o,r,s):t.push(r):t[n]=r})),t):Object.keys(r).reduce((function(t,n){var o=r[n];return i.call(t,n)?t[n]=e(t[n],o,s):t[n]=o,t}),a)}}},8913:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.env=t.config=void 0,t.config={port:8088,log:{level:"debug",map:{time:"@timestamp",msg:"message"},db:!0},db:{user:"dqcpsquyjmmxkb",host:"ec2-54-228-125-183.eu-west-1.compute.amazonaws.com",password:"1093639f514498fbf09e803d98714b853849704783dc052aa1ef2039c60fe6e0",database:"d8maa489i4calm",port:5432,ssl:{rejectUnauthorized:!1}},amq:{host:"localhost",port:61613,username:"admin",password:"admin",destinationName:"topic",subscriptionName:"sub-user"}},t.env={sit:{mongo:{db:"masterdata"}},prd:{log:{level:"error"},middleware:{log:!1}}}},7523:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.writeUser=t.log=t.createContext=t.user=void 0;const n=r(9249),s=r(6629),i=r(627),o=r(7210),a=r(9846),c=[5e3,1e4,2e4];function h(e){console.log(JSON.stringify(e))}function u(e){return console.log("Error: "+JSON.stringify(e)),Promise.resolve(1)}t.user={id:{length:40},username:{required:!0,length:255},email:{format:"email",required:!0,length:120},phone:{format:"phone",required:!0,length:14},dateOfBirth:{type:"datetime"}},t.createContext=function(e,r,l){var f=new a.ActiveMQChecker(l),d=(f=new n.HealthController([f]),e=new i.PostgreSQLWriter(e.exec,"activemq",t.user),e=new s.RetryWriter(e.write,c,u,h),new s.ErrorHandler(h)),p=new o.Validator(t.user,!0),m=new a.Subscriber(r,l.destinationName,l.subscriptionName,"client-individual",!0,h,h,void 0,void 0,void 0);return r=(0,a.createSender)(r,l.destinationName,l.subscriptionName),l=new s.RetryService(r.send,h,h),{handle:new s.Handler(e.write,p.validate,c,d.error,h,h,l.retry,3,"retry").handle,read:m.subscribe,health:f,send:r.send}},t.log=h,t.writeUser=u},3607:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(4946),i=n(r(9738)),o=n(r(3685)),a=r(2735),c=r(8955),h=r(627);t=r(8913);const u=r(7523),l=r(9846),f=(i.default.config(),(0,s.merge)(t.config,process.env,t.env,process.env.ENV));n=new c.Pool(f.db);const d=new h.PoolManager(n);new l.ActiveMQConnection(f.amq).connect().then((e=>{const t=(0,u.createContext)(d,e,f.amq);t.read(t.handle),o.default.createServer(((e,r)=>{"/health"===e.url?t.health.check(e,r):"/send"===e.url&&(0,a.getBody)(e).then((e=>{t.send(JSON.parse(e)).then((()=>{r.writeHead(200,{"Content-Type":"application/json"}),r.end(JSON.stringify({message:"message was produced"}))})).catch((e=>{r.writeHead(500,{"Content-Type":"application/json"}),r.end(JSON.stringify({error:e}))}))})).catch((e=>console.log(e)))})).listen(f.port,(()=>{console.log("Start server at port "+f.port)}))}))},4868:function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r=r||Promise)((function(s,i){function o(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):((t=e.value)instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.ActiveMQChecker=void 0;const s=r(5088);t.ActiveMQChecker=class{constructor(e,t,r){this.config=e,this.service=t,this.timeout=r,this.check=this.check.bind(this),this.name=this.name.bind(this),this.build=this.build.bind(this)}check(){const e={};var t,r=new Promise(((t,r)=>n(this,void 0,void 0,(function*(){try{yield(0,s.check)(this.config),t(e)}catch(e){r("Database down!")}}))));return this.timeout||(this.timeout=4200),0<this.timeout?(t=this.timeout,Promise.race([r,new Promise(((e,r)=>{setTimeout((()=>{r(`Timed out in: ${t} milliseconds!`)}),t)}))])):r}name(){return this.service||(this.service="activemq"),this.service}build(e,t){return t&&((e=e||{}).error=t),e}}},8009:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},5088:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&("get"in s?t.__esModule:!s.writable&&!s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.check=t.ActiveMQConnection=void 0;const o=i(r(4572));t.ActiveMQConnection=class{constructor(e){this.config=e,this.connect=this.connect.bind(this)}connect(){const e={host:this.config.host,port:this.config.port,connectHeaders:{host:"/",login:this.config.username,passcode:this.config.password,"heart-beat":this.config.heartBeat||"5000,0"}};var t={initialReconnectDelay:10,maxReconnectDelay:6e4,reconnectDelayExponent:2};const r=Object.assign(Object.assign({},t),t);return new Promise(((t,n)=>{const s=new o.ConnectFailover([e],r);s.on("connect",(()=>{console.log("[AMQ] Client connected to "+e.host)})),s.on("error",(e=>{console.log("[AMQ] Error connect init "+e+(new Date).toISOString())})),s.connect(((e,r,s)=>{e&&(console.log("[Error] AMQ cannot connect ",e),n(e)),r.on("error",(e=>{s()})),t(r)}))}))}},t.check=function(e){const t={host:e.host,port:e.port,connectHeaders:{host:"/",login:e.username,passcode:e.password,"heart-beat":e.heartBeat||"5000,0"}},r=(e={initialReconnectDelay:10,maxReconnectDelay:6e4,reconnectDelayExponent:2},Object.assign(Object.assign({},e),e));return new Promise(((e,n)=>{new o.ConnectFailover([t],r).connect(((t,r)=>{t&&n(t),r.on("error",(e=>{n(t)})),e()}))}))}},970:(e,t)=>{"use strict";function r(e){return"string"==typeof e?e:JSON.stringify(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.ts=t.toString=void 0,t.toString=function(e,t){return t&&0<Object.keys(t).length?"string"==typeof e?e+JSON.stringify(t):JSON.stringify(e)+" "+JSON.stringify(t):r(e)},t.ts=r},9846:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var s=Object.getOwnPropertyDescriptor(t,r);s&&("get"in s?t.__esModule:!s.writable&&!s.configurable)||(s={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,s)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(8009),t),s(r(4868),t),s(r(5088),t),s(r(6055),t),s(r(2812),t),s(r(4824),t)},6055:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},2812:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Subscriber=t.createReceiver=t.createReader=t.createConsumer=t.createSubscriber=void 0;const n=r(970);function s(e,t,r,n,s,o,a,c,h,u){return new i(e,t,r,n,s,o,a,c,h,u)}t.createSubscriber=s,t.createConsumer=s,t.createReader=s,t.createReceiver=s;class i{constructor(e,t,r,n,s,i,o,a,c,h){this.client=e,this.ackMode=n,this.ackOnConsume=s,this.logError=i,this.logInfo=o,this.prefix=a,this.encoding=h&&0<h.length?h:"utf-8",this.destinationName=t,this.subscriptionName=r,c&&0!==c.length?this.retryCountName=c:this.retryCountName="retryCount",this.subscribe=this.subscribe.bind(this),this.get=this.get.bind(this),this.receive=this.receive.bind(this),this.read=this.read.bind(this),this.consume=this.consume.bind(this)}get(e){return this.subscribe(e)}receive(e){return this.subscribe(e)}read(e){return this.subscribe(e)}consume(e){return this.subscribe(e)}subscribe(e){var t=this.prefix&&0<this.prefix.length?this.prefix:"/";t={destination:""+this.destinationName+t+this.subscriptionName,ack:this.ackMode,"subscription-type":"ANYCAST"},this.client.subscribe(t,((t,r)=>{t&&this.logError?this.logError("subscribe error "+t.message):(this.logInfo&&this.logInfo("received : "+r),r.readString(this.encoding,((t,s)=>{if(t&&this.logError)this.logError("read message error "+t.message);else{this.logInfo&&this.logInfo("received message: "+s);const i={};try{if(s){if(JSON.parse(s)[this.retryCountName])i.data=JSON.parse(s).data,i.attributes=JSON.parse(s)[this.retryCountName];else{const e={};e[this.retryCountName]="0",i.data=JSON.parse(s),i.attributes=e}if(!i.data)throw new Error("message is empty!");e(i.data,i.attributes,r)}}catch(t){this.logError&&this.logError("Fail to consume message: "+(0,n.toString)(t))}this.ackOnConsume&&"auto"!==this.ackMode&&this.client.ack(r)}})))}))}}t.Subscriber=i},4824:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Writer=t.createPublisher=t.createSender=t.createProducer=t.createWriter=void 0;const n=r(970);function s(e,t,r,n,s,o,a){return new i(e,t,r,n,s,o,a)}t.createWriter=s,t.createProducer=s,t.createSender=s,t.createPublisher=s;class i{constructor(e,t,r,n,s,i,o){this.client=e,this.destinationName=t,this.subscriptionName=r,this.logError=n,this.logInfo=s,this.contentType=i,this.prefix=o,this.write=this.write.bind(this),this.send=this.send.bind(this),this.publish=this.publish.bind(this),this.put=this.put.bind(this),this.produce=this.produce.bind(this)}put(e,t){return this.write(e,t)}send(e,t){return this.write(e,t)}produce(e,t){return this.write(e,t)}publish(e,t){return this.write(e,t)}write(e,t){var r=this.prefix&&0<this.prefix.length?this.prefix:"/";const s={destination:""+this.destinationName+r+this.subscriptionName,"content-type":this.contentType&&0<this.contentType.length?this.contentType:"text/plain"},i={data:e,attributes:t};return new Promise(((e,t)=>{const r=this.client.send(s);this.logInfo&&this.logInfo("produce message: "+JSON.stringify(i.data));var o=r.write(JSON.stringify(i.data));r.end((e=>{e&&(this.logError&&this.logError("ActiveMQ error when sending message: "+(0,n.toString)(e)),t(e))})),e(o)}))}}t.Writer=i},9820:e=>{e.exports=function(e){for(var r=1;r<arguments.length;r++){var n,s=arguments[r];for(n in s)t.call(s,n)&&(e[n]=s[n])}return e};var t=Object.prototype.hasOwnProperty},7210:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.isPhone=function(e){if(!e||0===e.length||"+"===e)return!1;if("+"!==e.charAt(0))return u(e);var t=e.substring(1);if(n.phonecodes){if(u(t))for(var r=1;r<=3;r++)if(t.substr(0,r)in n.phonecodes)return!0;return!1}return u(t)},n.isFax=function(e){return n.isPhone(e)},n.digit=/^\d+$/,n.email=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*(\.[a-zA-Z]{2,4})$/i,n.url=/[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,4}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/,n.ipv4=/^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$/,n.ipv6=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/;var r=n;function n(){}function s(e){if(e&&0!==e.length)for(var t=0,r=e;t<r.length;t++)if("string"!=typeof r[t])return!1;return!0}function i(e){if(e&&0!==e.length)for(var t=0;t<e.length;t++){var r=_(e[t]);if(!r)return!1;e[t]=r}return!0}function o(e){if(e&&0!==e.length)for(var t=0,r=e;t<r.length;t++)if("number"!=typeof r[t])return!1;return!0}function a(e){if(e&&0!==e.length)for(var t=0,r=e;t<r.length;t++){var n=r[t];if(!Number.isInteger(n))return!1}return!0}function c(e,t){for(var r=0,n=t;r<n.length;r++)if(e===n[r])return!0;return!1}function h(e){if(!e||0===e.length)return"";for(var t=[],r=0,n=e;r<n.length;r++){var s=n[r];t.push(""+s)}return t.join(",")}function u(e){return!!e&&r.digit.test(e)}function l(e){return!(!e||0===e.length)&&r.ipv4.test(e)}function f(e){return!(!e||0===e.length)&&r.ipv6.test(e)}function d(e){return!(!e||0===e.length)&&r.email.test(e)}function p(e){return r.url.test(e)}function m(e,t){if(isNaN(e)||void 0===e||null==e)return!0;if(void 0===t||null==t||t<0)return!0;var r=(e=e.toString()).indexOf(".");return r<0||e.substr(r+1).length<=t}function g(e,t,r){if(isNaN(e)||void 0===e||null==e)return!0;if(void 0===t||null==t||t<0)return m(e,r);(void 0===r||null==r||r<0)&&(r=0);var n=(e=e.toString()).indexOf(".");return n<0?e.length<=t-r:!(e.substr(n+1).length>r)&&e.substr(0,n).length<=t-r}function y(e,t,r,n){var s=t;return e={field:s=e&&0<e.length?e+"."+t:s,code:r=r||"string"},n&&(e.param=n),e}t.resources=r,t.isPhone=function(e){return r.isPhone(e)},t.isFax=function(e){return r.isFax(e)},t.isStrings=s,t.isDates=i,t.isNumbers=o,t.isIntegers=a,t.exist=c,t.toString=h,t.isDigitOnly=u,t.isIPv4=l,t.isIPv6=f,t.isEmail=d,t.isUrl=p,t.isValidScale=m,t.isValidPrecision=g;var b=/-?\d+/;function _(e){return e?e instanceof Date?e:"number"==typeof e?new Date(e):0<=e.indexOf("/Date(")?null!==(t=b.exec(e))?(r=parseInt(t[0],10),new Date(r)):null:isNaN(e)?new Date(e):(r=parseInt(e,10),new Date(r)):null;var t,r}function v(e,t,r,n){var s=(s=t.name)||"";t.min?e<t.min&&n.push(y(r,s,"min",t.min)):t.gt&&e<=t.gt&&n.push(y(r,s,"gt",t.gt)),t.max?e>t.max&&n.push(y(r,s,"max",t.max)):t.lt&&e>=t.lt&&n.push(y(r,s,"lt",t.lt))}function w(e,t,r,n){for(var s=0,i=n=n||Object.keys(t);s<i.length;s++){var o=i[s];t[o].required&&!e[o]&&r.push(y("",o,"required"))}}function E(e,t,n,u,b){var E=[];return function e(t,n,u,b,E,S,x){for(var C,k=0,P=0,O=Object.keys(t);P<O.length;P++){var T=O[P],A=(k+=1,n[T]);if(A){A.name=T;var R=A.name,M=t[R];if(null==M)A.required&&!S&&u.push(y(b,R,"required"));else{var I,D=typeof M,q=A.type;switch(q){case"datetime":var j=_(M);if(j){var N=j.toString();if(!(j instanceof Date&&"Invalid Date"!==N))return void u.push(y(b,R,"date"));M instanceof Date||(t[R]=j),v(M,A,b,u)}break;case"date":if(r.ignoreDate&&(N=_(M))){var F=N.toString();if(!(N instanceof Date&&"Invalid Date"!==F))return void u.push(y(b,R,"date"));M instanceof Date||(t[R]=j),v(M,A,b,u)}break;default:switch(D){case"string":if(void 0!==q&&"string"!==q&&"text"!==q)return void u.push(y(b,R,q));if(0===M.length)A.required&&u.push(y(b,R,"required"));else{if(A.min&&0<A.min&&M.length<A.min&&u.push(y(b,R,"minlength",A.min)),A.length&&0<A.length&&M.length>A.length&&u.push(y(b,R,"maxlength",A.length)),A.format)switch(A.format){case"email":d(M)||u.push(y(b,R,"email"));break;case"url":p(M)||u.push(y(b,R,"url"));break;case"phone":r.isPhone(M)||u.push(y(b,R,"phone"));break;case"fax":r.isFax(M)||u.push(y(b,R,"fax"));break;case"ipv4":l(M)||u.push(y(b,R,"ipv4"));break;case"ipv6":f(M)||u.push(y(b,R,"ipv6"))}A.exp&&("string"==typeof A.exp&&(A.exp=new RegExp(A.exp)),A.exp.test(M)||(I=A.code||"exp",u.push(y(b,R,I)))),A.enum&&0<A.enum.length&&(c(M,A.enum)||u.push(y(b,R,"enum",h(A.enum))))}break;case"number":if("integer"===A.type)Number.isInteger(M)||u.push(y(b,R,"integer"));else{if("number"!==A.type)return void u.push(y(b,R,A.type));A.precision?g(M,A.precision,A.scale)||u.push(y(b,R,"precision")):m(M,A.scale)||u.push(y(b,R,"scale"))}v(M,A,b,u),A.enum&&0<A.enum.length&&(c(M,A.enum)||u.push(y(b,R,"enum",h(A.enum))));break;case"boolean":if("boolean"!==q)return void u.push(y(b,R,q));break;case"object":if(Array.isArray(M)){switch(q){case"strings":s(M)||u.push(y(b,R,"strings"));break;case"numbers":o(M)||u.push(y(b,R,"numbers"));break;case"integers":a(M)||u.push(y(b,R,"integers"));break;case"datetimes":i(M)||u.push(y(b,R,"datetimes"));break;case"dates":r.ignoreDate&&!i(M)&&u.push(y(b,R,"dates"));break;case"array":for(var L=0;L<M.length;L++)"object"!=typeof M?(H=null!=b&&0<b.length?b+"."+T+"["+L+"]":T+"["+L+"]",u.push(y("",H,"object"))):A.typeof&&(H=null!=b&&0<b.length?b+"."+T+"["+L+"]":T+"["+L+"]",e(M[L],A.typeof,u,H));break;case"primitives":if("object"!=typeof M)return void u.push(y(b,R,"array"));if(!Array.isArray(M))return void u.push(y(b,R,"array"));if(A.code)if("date"===A.code){var B,Q;for(L=0;L<M.length;L++)M[L]&&(B=_(M))&&(Q=B.toString(),B instanceof Date&&"Invalid Date"!==Q||(U=y("",H=null!=b&&0<b.length?b+"."+T+"["+L+"]":T+"["+L+"]","date"),u.push(U)))}else{var H,U;for(L=0;L<M.length;L++)M[L]&&typeof M[L]!==A.code&&(U=y("",H=null!=b&&0<b.length?b+"."+T+"["+L+"]":T+"["+L+"]",A.code),u.push(U))}break;case"times":break;default:return void u.push(y(b,R,q))}A.min&&0<A.min&&M.length<A.min&&u.push(y(b,R,"min",A.min)),A.max&&0<A.max&&M.length>A.max&&u.push(y(b,R,"max",A.max))}else if("object"===q){if("object"!=typeof M)return void u.push(y(b,R,"object"));Array.isArray(M)?u.push(y(b,R,"object")):A.typeof&&(I=null!=b&&0<b.length?b+"."+T:T,e(M,A.typeof,u,I))}}}if(void 0!==x&&u.length>=x)return}}else E||u.push(y(b,T,"undefined"))}S||(C=Object.keys(n),!E&&k>=C.length||w(t,n,u,C))}(e,t,E,"",n,u,b=null==b?void 0:b),E}t.checkUndefined=w,t.check=E,t.validate=E,x.prototype.validate=function(e,t){return e=E(e,this.attributes,this.allowUndefined,t,this.max),Promise.resolve(e)};var S=x;function x(e,t,r){this.attributes=e,this.allowUndefined=t,this.max=r||10,this.validate=this.validate.bind(this)}t.Validator=S,t.createValidator=function(e,t,r){return new S(e,t,r)}},9491:e=>{"use strict";e.exports=require("assert")},6113:e=>{"use strict";e.exports=require("crypto")},9523:e=>{"use strict";e.exports=require("dns")},2361:e=>{"use strict";e.exports=require("events")},7147:e=>{"use strict";e.exports=require("fs")},3685:e=>{"use strict";e.exports=require("http")},1808:e=>{"use strict";e.exports=require("net")},2037:e=>{"use strict";e.exports=require("os")},1017:e=>{"use strict";e.exports=require("path")},2781:e=>{"use strict";e.exports=require("stream")},1576:e=>{"use strict";e.exports=require("string_decoder")},4404:e=>{"use strict";e.exports=require("tls")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},2466:e=>{"use strict";e.exports=JSON.parse('{"name":"pg","version":"8.7.3","description":"PostgreSQL client - pure javascript & libpq with the same API","keywords":["database","libpq","pg","postgre","postgres","postgresql","rdbms"],"homepage":"https://github.com/brianc/node-postgres","repository":{"type":"git","url":"git://github.com/brianc/node-postgres.git","directory":"packages/pg"},"author":"Brian Carlson <brian.m.carlson@gmail.com>","main":"./lib","dependencies":{"buffer-writer":"2.0.0","packet-reader":"1.0.0","pg-connection-string":"^2.5.0","pg-pool":"^3.5.1","pg-protocol":"^1.5.0","pg-types":"^2.1.0","pgpass":"1.x"},"devDependencies":{"async":"0.9.0","bluebird":"3.5.2","co":"4.6.0","pg-copy-streams":"0.3.0"},"peerDependencies":{"pg-native":">=2.0.0"},"peerDependenciesMeta":{"pg-native":{"optional":true}},"scripts":{"test":"make test-all"},"files":["lib","SPONSORS.md"],"license":"MIT","engines":{"node":">= 8.0.0"},"gitHead":"4fa7ee891a456168a75695ac026792136f16577f"}')}},t={};!function r(n){var s=t[n];return void 0!==s||(s=t[n]={exports:{}},e[n].call(s.exports,s,s.exports,r)),s.exports}(3607)})();